# 供应商资料管理模块界面详细介绍

> **AI编程组长指南**: 本文档详细描述SQE数据分析助手供应商资料管理模块的完整界面结构、架构设计和功能实现。作为开发参考文档，帮助AI协作开发者快速理解项目现状。

## 📋 项目概览

### 系统名称
SQE 供应商管理系统 v2.0

### 模块定位
供应商资料管理模块是系统的核心功能模块之一，负责管理供应商的各类资质文件、检测报告和认证资料。

### 技术架构
- **前端**: 原生JavaScript + CSS3 + HTML5
- **后端**: Node.js + Express + Sequelize ORM
- **数据库**: SQLite
- **文件存储**: 本地文件系统

---

## 🎨 界面整体架构

### 主界面布局图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          SQE 供应商管理系统 v2.0                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌───────────────┐  ┌─────────────────────────────────────────────────────┐  │
│  │               │  │                  顶部工具栏                          │  │
│  │               │  │  供应商资料管理                    [🔄] [🔄]        │  │
│  │   侧边栏导航   │  ├─────────────────────────────────────────────────────┤  │
│  │               │  │                                                         │  │
│  │ • 工作台       │  │  ┌─────────────────────────────────────────────────┐  │  │
│  │ • IQC质量分析  │  │  │              搜索和筛选区域                      │  │  │
│  │ • 供应商资料管理│  │  │  🔍 [搜索供应商名称...]  [📊状态筛选] [📄资料筛选] │  │  │
│  │ • 月度绩效评价  │  │  └─────────────────────────────────────────────────┘  │  │
│  │               │  │                                                         │  │
│  │               │  │  ┌─────────────────────────────────────────────────┐  │  │
│  │               │  │  │              供应商汇总表格                      │  │  │
│  │               │  │  │  ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐ │  │
│  │               │  │  │  │供应商│   MSDS   │   质量协议   │  ROHS  │ REACH │  HF  │物料 │操作 │ │  │
│  │               │  │  │  │名称  │  🟢永久   │   🟢永久    │ ⚠️5份 │ ✅8份 │ ❌0份│数量 │     │ │  │
│  │               │  │  │  ├─────┼──────────┼─────────────┼────────┼───────┼──────┼─────┼─────┤ │  │
│  │               │  │  │  │晶蓝  │  🟢永久   │   🟢永久    │ ⚠️5份 │ ✅8份 │ ❌0份│12个 │[📂]│ │  │
│  │               │  │  │  │光电  │  状态显示  │   状态显示   │ 统计  │ 统计  │ 统计 │     │展开│ │  │
│  │               │  │  │  └─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘ │  │
│  └───────────────┘  │                                                         │  │
│                     │  ┌─────────────────────────────────────────────────┐  │  │
│                     │  │              展开详情区域                        │  │  │
│                     │  │  ┌─ 📋 通用资料 ────────────────────────────────┐ │  │
│                     │  │  │ [📧批量邮件] [📤上传] [⚙️资料类型设置]          │ │  │
│                     │  │  │ • 🟢 质量保证协议 - 永久有效         [📧✏️🗑️📁] │ │  │
│                     │  │  │ • 🟡 MSDS安全数据表 - 剩余30天      [📧✏️🗑️📁] │ │  │
│                     │  │  └─────────────────────────────────────────────┘ │  │
│                     │  │  ┌─ 🏭 检测报告 ────────────────────────────────┐ │  │
│                     │  │  │ [➕新增物料]                                 │ │  │
│                     │  │  │ ┌─ 📦 物料：PCB板 ────────────────────────┐ │ │  │
│                     │  │  │ │ [📧批量邮件] [📤上传资料] [🗑️删除物料]    │ │  │
│                     │  │  │ │ ├─ 🎯 本体检测                           │ │  │
│                     │  │  │ │ │ • 🟢 ROHS证书 - 剩余60天 [📧✏️🗑️📁]  │ │  │
│                     │  │  │ │ └─ 🔗 引用检测                           │ │  │
│                     │  │  │ │   ├─ 🧪 构成A：铜箔                      │ │  │
│                     │  │  │ │   │ • 🟡 REACH证书 - 剩余15天 [📧✏️🗑️📁]│ │  │
│                     │  │  │ │   └─ 🧪 构成B：树脂                      │ │  │
│                     │  │  │ │     • 🔴 HF证书 - 已过期5天 [📧✏️🗑️📁] │ │  │
│                     │  │  │ └─────────────────────────────────────────┘ │ │  │
│                     │  │  └─────────────────────────────────────────────┘ │  │
│                     │  └─────────────────────────────────────────────────┘  │  │
│                     └─────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 🏗️ 系统架构层次

### 1. 前端架构 (Frontend)

#### 1.1 模块化文件组织
```
public/js/modules/supplier/
├── supplier.js                    # 主控制器 (v3.1)
├── services/
│   ├── supplier-services.js       # API服务封装
│   ├── document-type-service.js   # 文档类型服务
│   └── document-type-config.js    # 文档类型配置
└── ui/
    ├── modal-manager.js           # 统一弹窗管理器
    ├── document-type-settings-ui.js  # 文档类型设置UI
    ├── document-type-simple-ui.js    # 简化文档类型UI
    └── ui-utils.js                # UI工具函数
```

#### 1.2 CSS样式架构
```
public/css/modules/
├── supplier-table.css             # 表格样式
├── supplier-modal.css             # 基础模态框样式
├── supplier-modal-enhanced.css    # 增强模态框样式
├── supplier-modals-unified.css    # 统一弹窗样式 (BEM规范)
├── supplier-interactions.css      # 交互动画
├── supplier-status-badges.css     # 状态徽章
└── document-type-settings.css     # 文档类型设置样式
```

### 2. 后端架构 (Backend)

#### 2.1 API路由层
```
server/routes/
├── suppliers-summary.js           # 供应商汇总API
├── suppliers.js                   # 供应商CRUD API
├── documents-upload.js            # 文档上传API
├── materials.js                   # 物料管理API
└── document-types.js              # 文档类型管理API
```

#### 2.2 数据模型层
```
server/models/
├── Supplier.js                    # 供应商基础信息
├── SupplierDocument.js            # 供应商文档
├── Material.js                    # 物料信息
└── MaterialComponent.js           # 物料构成
```

---

## 📊 详细界面组件说明

### 1. 顶部操作区域

#### 1.1 模块标题栏
```html
<div class="module-header">
  <h3>供应商资料管理</h3>
  <div class="module-actions">
    <button class="btn btn-success" id="importBtn">
      <span class="btn-icon">🔄</span>
      同步供应商
    </button>
    <button class="btn btn-secondary" id="refreshBtn">
      <span class="btn-icon">🔄</span>
      刷新
    </button>
  </div>
</div>
```

**功能说明**:
- **同步供应商** (`importBtn`): 从IQC模块同步供应商数据，创建文件夹结构
- **刷新** (`refreshBtn`): 刷新当前显示的数据，保持展开状态

#### 1.2 搜索筛选区域
```html
<div class="supplier-controls">
  <div class="search-section">
    <input type="text" id="supplierSearch" placeholder="搜索供应商名称..."
           value="${this.searchKeyword}" class="search-input">
    <button onclick="supplierManager.clearSearch()" class="clear-search-btn">✕</button>
  </div>
  <div class="filter-section">
    <select id="statusFilter" onchange="supplierManager.filterByStatus()" class="filter-select">
      <option value="">全部状态</option>
      <option value="normal">🟢 正常</option>
      <option value="warning">🟡 即将到期</option>
      <option value="urgent">🔴 紧急</option>
      <option value="expired">❌ 已过期</option>
    </select>
    <select id="documentFilter" onchange="supplierManager.filterByDocument()" class="filter-select">
      <option value="">全部资料</option>
      <option value="missing_msds">缺失MSDS</option>
      <option value="missing_qa">缺失质量协议</option>
      <option value="missing_rohs">缺失ROHS</option>
      <option value="missing_reach">缺失REACH</option>
      <option value="missing_hf">缺失HF</option>
    </select>
  </div>
</div>
```

**功能说明**:
- **搜索框**: 实时搜索供应商名称，支持防抖(300ms)
- **状态筛选**: 按文档到期状态筛选供应商
- **资料筛选**: 按缺失的资料类型筛选供应商

### 2. 供应商汇总表格

#### 2.1 表头结构
```html
<table class="supplier-table">
  <thead>
    <tr>
      <th>供应商</th>
      <th>MSDS</th>
      <th>质量协议</th>
      <th>ROHS</th>
      <th>REACH</th>
      <th>HF</th>
      <th>物料</th>
      <th>操作</th>
    </tr>
  </thead>
</table>
```

#### 2.2 数据行渲染逻辑
每个供应商行显示：
- **供应商名称**: 点击可查看详情
- **MSDS状态**: 显示到期时间和状态图标（仅状态预览，无操作按钮）
- **质量协议状态**: 显示到期时间和状态图标（仅状态预览，无操作按钮）
- **ROHS/REACH/HF统计**: 显示份数和最差状态（仅统计信息，无操作按钮）
- **物料数量**: 该供应商的物料总数
- **展开/收起按钮**: 📂 展开 / 📁 收起

**重要说明**:
- 汇总表格仅提供**状态预览**功能，不包含邮件、编辑等操作按钮
- 所有操作功能（邮件发送、文档编辑、删除、上传等）都在**展开后的详情区域**中实现
- 这样的设计避免表格过于臃肿，保持界面简洁清晰

#### 2.3 状态显示规则
```javascript
// 状态优先级和显示逻辑
const statusPriority = {
  'normal': 0,      // 🟢 正常
  'warning': 1,     // 🟡 警告(30天内)
  'urgent': 2,      // 🟠 紧急(15天内)
  'critical': 3,    // 🔴 紧急(7天内)
  'expired': 4      // ❌ 已过期
};

// 计算剩余天数
let daysUntilExpiry = Math.ceil((new Date(expiryDate) - new Date()) / (1000 * 60 * 60 * 24));

// 状态判断逻辑
if (daysUntilExpiry < 0) warningLevel = 'expired';
else if (daysUntilExpiry <= 7) warningLevel = 'critical';
else if (daysUntilExpiry <= 15) warningLevel = 'urgent';
else if (daysUntilExpiry <= 30) warningLevel = 'warning';
```

### 3. 展开详情区域

#### 3.1 通用资料区域
```html
<div class="details-section">
  <div class="section-header">
    <h4>📋 通用资料</h4>
    <div class="section-actions">
      <button class="email-btn batch-email-btn" data-type="common"
              data-supplier-id="${supplierId}" title="批量邮件通知">
        📧 批量邮件
      </button>
      <button class="upload-btn" data-type="common"
              data-supplier-id="${supplierId}" title="上传通用资料">
        📤 上传
      </button>
      <button class="settings-btn document-type-settings-btn"
              data-type="common" title="资料类型设置">
        ⚙️ 资料类型设置
      </button>
    </div>
  </div>
  <!-- 文档列表 -->
  <ul class="document-list">
    <li class="document-item ${doc.status}">
      <span class="doc-icon">${window.supplierServices.getStatusIcon(doc.status)}</span>
      <span class="doc-type">${window.supplierServices.getCertificateTypeTextSync(doc.documentType)}</span>
      <span class="doc-name">${doc.documentName}</span>
      <span class="doc-expiry">
        ${doc.isPermanent ? '永久有效' : `到期: ${window.supplierServices.formatDate(doc.expiryDate)}`}
      </span>
      <div class="doc-actions">
        <button class="action-btn email-btn single-email-btn"
                data-document-id="${doc.id}" title="发送邮件">📧</button>
        <button class="action-btn edit-btn"
                data-document-id="${doc.id}" title="编辑">✏️</button>
        <button class="action-btn delete-btn"
                data-document-id="${doc.id}" title="删除">🗑️</button>
        <button class="action-btn folder-btn"
                data-file-path="${doc.filePath}" title="打开文件夹">📁</button>
      </div>
    </li>
  </ul>
</div>
```

**功能按钮说明**:
- **📧 批量邮件**: 生成该供应商所有即将到期通用资料的邮件通知
- **📤 上传**: 打开上传模态框，上传新的通用资料
- **⚙️ 资料类型设置**: 管理文档类型，可添加/编辑/删除自定义类型

#### 3.2 检测报告区域
```html
<div class="details-section">
  <div class="section-header">
    <h4>🏭 检测报告</h4>
    <div class="section-actions">
      <button class="add-material-btn" data-supplier-id="${supplierId}" title="新增物料">
        ➕ 新增物料
      </button>
    </div>
  </div>
  <div class="materials-container">
    <!-- 物料列表 -->
    <div class="material-section">
      <div class="material-header">
        <h5>📦 物料：${material.materialName}</h5>
        <div class="material-actions">
          <button class="email-btn batch-email-btn" data-type="material"
                  data-supplier-id="${supplierId}" data-material-id="${material.materialId}"
                  title="批量邮件通知">📧 批量邮件</button>
          <button class="upload-btn" data-type="material"
                  data-supplier-id="${supplierId}" data-material-id="${material.materialId}"
                  title="上传物料资料">📤 上传资料</button>
          <button class="action-btn delete-material-btn"
                  data-supplier-id="${supplierId}" data-material-id="${material.materialId}"
                  title="删除物料">🗑️ 删除物料</button>
        </div>
      </div>

      <!-- 本体检测文档 -->
      <div class="detection-section">
        <h6 class="detection-title">🎯 本体检测</h6>
        <ul class="document-list">
          <!-- 文档项列表 -->
        </ul>
      </div>

      <!-- 引用检测构成 -->
      <div class="detection-section">
        <h6 class="detection-title">🔗 引用检测</h6>
        <div class="component-section">
          <h7 class="component-title">🧪 ${componentName}</h7>
          <ul class="document-list">
            <!-- 构成文档列表 -->
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
```

**检测类型说明**:
- **🎯 本体检测**: 检测对象是供应商交付的物料本身
- **🔗 引用检测**: 检测对象是上游材料/零件的检测报告

---

## 🔧 核心功能模块

### 1. 文档上传功能

#### 1.1 上传模态框结构
```html
<div id="uploadModal" class="supplier-modal supplier-modal--upload">
  <div class="supplier-modal__content">
    <div class="supplier-modal__header">
      <h3 class="supplier-modal__title">上传资料</h3>
      <button class="supplier-modal__close upload-modal-close">&times;</button>
    </div>
    <div class="supplier-modal__body">
      <form id="uploadForm">
        <!-- 供应商信息 -->
        <div class="supplier-form__group">
          <label class="supplier-form__label">供应商</label>
          <input type="text" id="uploadSupplierName" readonly>
        </div>

        <!-- 物料信息 (仅物料资料时显示) -->
        <div class="form-group" id="materialGroup">
          <label>物料</label>
          <input type="text" id="uploadMaterialName" readonly>
        </div>

        <!-- 检测类型选择 -->
        <div class="form-group" id="detectionTypeGroup">
          <label>🎯 检测类型</label>
          <div class="detection-type-options">
            <div class="detection-type-option">
              <label>
                <input type="radio" name="detectionType" value="direct" checked>
                <span>本体检测</span>
              </label>
              <small>检测对象是供应商交付的物料本身</small>
            </div>
            <div class="detection-type-option">
              <label>
                <input type="radio" name="detectionType" value="referenced">
                <span>引用检测</span>
              </label>
              <small>检测对象是上游材料/零件的检测报告</small>
            </div>
          </div>
        </div>

        <!-- 构成选择 (引用检测时显示) -->
        <div class="form-group" id="componentGroup">
          <label>🧪 选择构成</label>
          <select id="componentSelect" class="component-select">
            <option value="">请选择构成</option>
          </select>
          <button type="button" id="openComponentManagementBtn" class="add-component-btn">
            ➕ 添加新构成
          </button>
        </div>

        <!-- 资料类型 -->
        <div class="form-group">
          <label>资料类型</label>
          <select id="documentType" required>
            <option value="">请选择</option>
            <!-- 动态加载资料类型 -->
          </select>
        </div>

        <!-- 文件上传区域 -->
        <div class="form-group">
          <label>选择文件</label>
          <div class="upload-drop-zone" id="uploadDropZone">
            <div class="upload-icon">📁</div>
            <p>拖拽文件到此处或点击选择</p>
            <input type="file" id="fileInput" accept=".pdf,.xlsx,.xls,.doc,.docx" style="display: none;">
          </div>
          <div id="filePreview" class="file-preview">
            <span class="file-name"></span>
            <button type="button" class="remove-file" onclick="supplierManager.removeSelectedFile()">&times;</button>
          </div>
        </div>

        <!-- 到期日期 -->
        <div class="form-group">
          <label>
            <input type="checkbox" id="isPermanent" onchange="supplierManager.togglePermanentDate()">
            永久有效
          </label>
          <input type="date" id="expiryDate" class="expiry-date">
        </div>

        <!-- 备注 -->
        <div class="form-group">
          <label>备注</label>
          <textarea id="documentRemark" rows="3" placeholder="请输入备注信息"></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary upload-cancel-btn">取消</button>
      <button type="button" class="btn btn-primary upload-submit-btn">上传</button>
    </div>
  </div>
</div>
```

#### 1.2 上传流程
1. **选择上传位置**: 通用资料 / 物料资料
2. **填写基本信息**: 选择资料类型、检测类型、构成等
3. **上传文件**: 支持拖拽上传，限制10MB
4. **设置到期日期**: 可选择永久有效或设置具体日期
5. **提交上传**: 调用`/api/documents/upload`接口

### 2. 邮件通知功能

#### 2.1 单个邮件生成
```javascript
async generateSingleEmail(documentId, supplierId) {
  // 1. 获取供应商和文档信息
  // 2. 准备邮件变量
  const variables = {
    供应商名称: supplier.supplierName,
    物料名称: targetDoc.materialName || '',
    具体构成名称: targetDoc.componentName || '',
    证书类型: certificateTypeText,
    到期日期: targetDoc.isPermanent ? '永久有效' : window.supplierServices.formatDate(targetDoc.expiryDate),
    剩余天数: targetDoc.isPermanent ? '永久有效' : `${targetDoc.daysUntilExpiry}天`,
    SQE工程师联系方式: 'SQE团队'
  };

  // 3. 生成邮件内容
  const template = window.supplierServices.getEmailTemplate();
  const emailContent = window.supplierServices.replaceEmailVariables(template, variables);

  // 4. 显示邮件预览模态框
  window.supplierUIUtils.showEmailModal(subject, emailContent);
}
```

#### 2.2 批量邮件生成
- 收集所有即将到期的文档(30天内或已过期)
- 按证书类型分组汇总
- 生成统一的邮件通知内容
- 支持复制到剪贴板功能

### 3. 文档类型管理

#### 3.1 预设文档类型
```json
[
  {
    "id": "doc_type_001",
    "name": "质量保证协议",
    "category": "common",
    "isRequired": true,
    "isSystemDefault": true
  },
  {
    "id": "doc_type_002",
    "name": "MSDS安全数据表",
    "category": "common",
    "isRequired": true,
    "isSystemDefault": true
  },
  {
    "id": "doc_type_101",
    "name": "ROHS证书",
    "category": "material",
    "isRequired": true,
    "isSystemDefault": true
  }
]
```

#### 3.2 动态类型管理
- 支持添加自定义文档类型
- 可编辑类型名称和描述
- 支持禁用/启用类型
- 按类别分组(通用/物料)

---

## 📱 数据库设计

### 1. 核心表结构

#### 1.1 供应商表 (suppliers)
```sql
CREATE TABLE suppliers (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  code STRING,                    -- 供应商编码
  name STRING NOT NULL UNIQUE,    -- 供应商名称
  contact_person STRING,          -- 联系人
  contact_email STRING,           -- 联系邮箱
  contact_phone STRING,           -- 联系电话
  level ENUM('Strategic', 'Core', 'General', 'Eliminated'),  -- 供应商等级
  status ENUM('Active', 'Inactive', 'Blacklisted'),          -- 状态
  address STRING,                 -- 地址
  notes TEXT                      -- 备注
);
```

#### 1.2 物料表 (materials)
```sql
CREATE TABLE materials (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  supplier_id INTEGER NOT NULL,   -- 所属供应商
  material_name STRING NOT NULL,  -- 物料名称
  material_code STRING,           -- 物料编码
  description TEXT,               -- 物料描述
  status ENUM('Active', 'Inactive') DEFAULT 'Active',
  FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);
```

#### 1.3 物料构成表 (material_components)
```sql
CREATE TABLE material_components (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  material_id INTEGER NOT NULL,   -- 所属物料
  component_name STRING NOT NULL, -- 构成名称
  component_code STRING,          -- 构成编码
  description TEXT,               -- 构成描述
  status ENUM('Active', 'Inactive') DEFAULT 'Active',
  FOREIGN KEY (material_id) REFERENCES materials(id)
);
```

#### 1.4 供应商文档表 (supplier_documents)
```sql
CREATE TABLE supplier_documents (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  supplier_id INTEGER,            -- 供应商ID(通用资料)
  material_id INTEGER,            -- 物料ID(物料资料)
  component_id INTEGER,           -- 构成ID(引用检测)
  document_type STRING NOT NULL,  -- 文档类型
  document_name STRING NOT NULL,  -- 文档名称
  file_path STRING,               -- 文件路径
  expiry_date DATE,               -- 到期日期
  is_permanent BOOLEAN DEFAULT 0, -- 是否永久有效
  detection_type ENUM('direct', 'referenced'), -- 检测类型
  level ENUM('supplier', 'material', 'component'), -- 文档层级
  status ENUM('active', 'inactive') DEFAULT 'active',
  is_current BOOLEAN DEFAULT 1,   -- 是否当前版本
  remarks TEXT,                   -- 备注
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 2. 数据流架构

```
前端请求 → API路由 → 业务逻辑 → 数据查询 → 数据库
    ↓           ↓          ↓          ↓         ↓
  用户操作   HTTP请求   数据处理   SQL执行   数据存储
    ↓           ↓          ↓          ↓         ↓
  界面更新   JSON响应   业务验证   ORM映射   持久化
```

---

## 🎯 交互逻辑详解

### 1. 页面加载流程

```mermaid
graph TD
    A[页面加载] --> B[检查认证状态]
    B --> C[初始化供应商模块]
    C --> D[加载供应商汇总数据]
    D --> E[渲染汇总表格]
    E --> F[绑定事件监听器]
    F --> G[页面就绪]
```

### 2. 展开/收起详情流程

```mermaid
graph TD
    A[点击展开按钮] --> B{是否已展开}
    B -->|是| C[收起详情]
    B -->|否| D[加载供应商详情]
    D --> E{缓存中存在}
    E -->|是| F[使用缓存数据]
    E -->|否| G[调用API获取详情]
    G --> H[存储到缓存]
    H --> I[渲染详情区域]
    I --> J[展开完成]
    C --> K[重新渲染表格]
```

### 3. 文件上传流程

```mermaid
graph TD
    A[选择上传位置] --> B[打开上传模态框]
    B --> C[填写表单信息]
    C --> D[选择文件]
    D --> E[验证文件格式]
    E --> F{验证通过}
    F -->|否| G[显示错误信息]
    F -->|是| H[上传文件]
    H --> I{上传成功}
    I -->|否| J[显示错误信息]
    I -->|是| K[关闭模态框]
    K --> L[刷新数据]
```

---

## 🔔 状态管理

### 1. 文档状态规则

| 状态 | 条件 | 图标 | 颜色 | 说明 |
|------|------|------|------|------|
| normal | 剩余天数 > 30 | ✅ | 绿色 | 正常 |
| warning | 15 < 剩余天数 ≤ 30 | ⚠️ | 黄色 | 警告 |
| urgent | 7 < 剩余天数 ≤ 15 | ⚡ | 橙色 | 紧急 |
| critical | 0 < 剩余天数 ≤ 7 | 🔴 | 红色 | 非常紧急 |
| expired | 剩余天数 < 0 | ❌ | 深红 | 已过期 |
| permanent | isPermanent = true | ♾️ | 蓝色 | 永久有效 |

### 2. 缓存策略

```javascript
// 详情数据缓存
this.detailsCache = {};

// 智能缓存策略
async loadDetails(supplierId) {
  // 1. 检查缓存
  if (this.detailsCache[supplierId]) {
    return this.detailsCache[supplierId];
  }

  // 2. 加载数据
  const details = await api.getSupplierDetails(supplierId);

  // 3. 存储缓存
  this.detailsCache[supplierId] = details;

  // 4. 设置5-10分钟过期
  setTimeout(() => {
    delete this.detailsCache[supplierId];
  }, 5 * 60 * 1000);
}
```

---

## 🛠️ 技术特性

### 1. 性能优化

#### 1.1 虚拟滚动
- 大量供应商时启用虚拟滚动
- 只渲染可视区域内的行
- 提升页面响应速度

#### 1.2 防抖搜索
```javascript
// 搜索防抖(300ms)
searchInput.oninput = (e) => {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    this.searchKeyword = e.target.value.trim();
    this.render();
  }, 300);
};
```

#### 1.3 智能缓存
- 详情数据缓存5-10分钟
- 避免重复API调用
- 刷新时智能清除相关缓存

### 2. 用户体验

#### 2.1 拖拽上传
- 支持文件拖拽上传
- 实时预览文件信息
- 上传进度显示

#### 2.2 键盘导航
- Tab键切换表单元素
- Enter键确认操作
- Escape键关闭模态框

#### 2.3 响应式设计
- 移动端适配
- 触摸手势支持
- 自适应布局

### 3. 错误处理

#### 3.1 网络异常
- 自动重试机制
- 离线状态提示
- 数据同步恢复

#### 3.2 文件上传异常
- 文件大小限制(10MB)
- 格式验证(PDF/Excel/Word)
- 上传失败重试

---

## 📚 API接口文档

### 1. 供应商汇总接口

**GET** `/api/suppliers/summary`

**响应示例**:
```json
{
  "success": true,
  "data": [
    {
      "supplierId": 1,
      "supplierName": "晶蓝光电",
      "materialCount": 12,
      "commonDocuments": {
        "environmental_msds": {
          "documentName": "MSDS安全数据表",
          "expiryDate": "2025-12-31",
          "daysUntilExpiry": 30,
          "isPermanent": false,
          "status": "warning"
        }
      },
      "materialDocuments": {
        "rohs": { "count": 5, "worstStatus": "normal" },
        "reach": { "count": 8, "worstStatus": "warning" },
        "hf": { "count": 0, "worstStatus": "normal" }
      }
    }
  ]
}
```

### 2. 供应商详情接口

**GET** `/api/suppliers/:id/details`

**响应示例**:
```json
{
  "success": true,
  "data": {
    "supplierId": 1,
    "supplierName": "晶蓝光电",
    "commonDocuments": [
      {
        "id": 1,
        "documentType": "environmental_msds",
        "documentName": "MSDS安全数据表",
        "expiryDate": "2025-12-31",
        "daysUntilExpiry": 30,
        "isPermanent": false,
        "status": "warning",
        "filePath": "D:/资料档案/晶蓝/通用资料"
      }
    ],
    "materials": [
      {
        "materialId": 1,
        "materialName": "PCB板",
        "directDocuments": [
          {
            "documentId": 10,
            "documentType": "environmental_rohs",
            "documentName": "ROHS证书",
            "expiryDate": "2025-12-31",
            "daysUntilExpiry": 60,
            "isPermanent": false,
            "status": "normal"
          }
        ],
        "referencedComponents": {
          "铜箔": {
            "componentId": 1,
            "componentName": "铜箔",
            "documents": [
              {
                "documentId": 15,
                "documentType": "environmental_reach",
                "documentName": "REACH证书",
                "expiryDate": "2025-12-31",
                "daysUntilExpiry": 15,
                "isPermanent": false,
                "status": "urgent"
              }
            ]
          }
        }
      }
    ]
  }
}
```

---

## 🎨 样式规范

### 1. BEM命名规范

```css
/* 块(Block) */
.supplier-modal {}

/* 元素(Element) */
.supplier-modal__header {}
.supplier-modal__content {}
.supplier-modal__title {}

/* 修饰符(Modifier) */
.supplier-modal--upload {}
.supplier-modal--edit {}
.supplier-modal__button--primary {}
.supplier-modal__button--secondary {}
```

### 2. 色彩系统

```css
:root {
  /* 主色调 */
  --primary-color: #2563eb;
  --primary-hover: #1d4ed8;

  /* 状态色彩 */
  --success-color: #22c55e;
  --warning-color: #f59e0b;
  --danger-color: #ef4444;
  --info-color: #3b82f6;

  /* 文档状态色彩 */
  --status-normal: #22c55e;
  --status-warning: #f59e0b;
  --status-urgent: #f97316;
  --status-critical: #ef4444;
  --status-expired: #991b1b;
}
```

---

## 🔮 未来优化方向

### 1. 功能增强
- [ ] 批量操作优化
- [ ] 高级搜索功能
- [ ] 数据导入导出
- [ ] 审批工作流

### 2. 性能提升
- [ ] 离线数据缓存
- [ ] 数据分页加载
- [ ] 图片懒加载
- [ ] 服务端渲染

### 3. 用户体验
- [ ] 快捷键支持
- [ ] 拖拽排序
- [ ] 多语言支持
- [ ] 主题切换

---

## 📞 联系信息

**文档维护**: AI编程团队
**最后更新**: 2025-12-15
**版本**: v3.1

---

> 💡 **提示**: 本文档与代码同步更新，如有疑问请参考最新代码实现。作为AI协作开发者，请严格遵循本文档的架构设计和开发规范。