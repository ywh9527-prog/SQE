# 供应商月度评价系统 - 需求整理与理解

## 项目背景与目标

基于现有SQE供应商管理系统（Node.js + Express + SQLite），开发供应商月度评价功能。目标是实现质量、交付、服务多维度综合评价，帮助质量工程师全面了解供应商表现，提供数据支持的决策依据。

## 核心需求

### 1. 数据来源
- **供应商列表**：从供应商配置中心（VendorConfig表）获取已启用绩效评价的供应商（enable_performance_mgmt=true）
- **质量数据**：从IQCData表自动提取，基于评价周期的合格率计算质量分数（IQC模块已有passRate计算逻辑）
- **交付和服务数据**：由用户在评价界面手动录入

### 2. 评价维度与配置
- **默认维度**：质量、交付、服务三个维度
- **维度自定义**：支持用户添加、删除、修改评价维度（如添加"成本"、"技术能力"等）
- **权重配置**：各维度权重可自定义（如质量50%、交付30%、服务20%）
- **等级规则**：可自定义各等级的分数范围和标签（默认：>=95优秀，85-94合格，70-84整改后合格，<70不合格）
- **配置管理**：提供完整的配置管理界面，用户可以随时修改配置

### 3. 评价周期
- **周期类型**：系统预设标准周期（月度、季度、年度），用户选择后自动生成周期范围
- **评价时机**：在周期结束后进行评价（如1月结束，在2月初评价1月）
- **周期管理**：支持创建、查看、删除评价周期

### 4. 评价流程
- **单次评价**：每次评价时，用户选择一个评价周期，系统加载该周期的所有已启用绩效评价的供应商
- **质量数据预计算**：在评价开始时，批量提取并缓存所有供应商的质量数据，评价时直接使用缓存数据
- **逐个评价**：用户逐个评价供应商，在侧边栏中输入各维度分数和备注
- **中途保存**：支持中途保存评价进度，防止数据丢失
- **提交评价**：评价完成后提交，将状态改为completed

### 5. 数据存储
- **多表关联**：使用PerformanceEvaluation主表和PerformanceEvaluationDetail从表存储评价结果
- **配置快照**：评价周期创建时保存配置快照，后续评价不受配置变更影响
- **质量数据快照**：保存评价时的质量数据快照，便于追溯
- **灵活扩展**：使用JSON字段存储自定义维度和分数，支持灵活扩展

### 6. 界面设计

#### 主界面（分层式仪表盘布局）
- **用途**：查看供应商评价结果，不包括评价操作
- **布局**：
  - 顶部统计区：平均总分、等级分布、关键指标
  - 中部图表区：趋势图、分布图、雷达图
  - 底部表格区：供应商排名表格（排名、供应商名称、总分、等级、各维度进度条、趋势）
- **周期选择**：默认显示最新评价周期，提供周期选择器，用户可切换查看不同历史周期的数据
- **不包含**：评价操作、评分规则权重和等级显示

#### 评价界面（卡片式一览表 + 侧边栏评价）
- **主区域**：卡片式供应商列表，每个卡片显示供应商名称、质量数据（总批次、合格批次、合格率）、已评价状态
- **侧边栏**：点击卡片后展开，显示评价表单（各维度评分输入框、评价备注、保存按钮）
- **顶部操作区**：周期信息显示、配置按钮、退出按钮

#### 配置管理界面
- **维度管理**：添加/删除/修改评价维度，设置权重
- **等级规则**：设置各等级的分数范围和标签
- **保存/重置按钮**

### 7. 实施策略
- **快速迭代**：先实现核心功能，快速上线，后续再添加高级功能
- **分阶段实施**：
  - 阶段一：数据库和后端基础
  - 阶段二：评价功能实现
  - 阶段三：主界面展示
  - 阶段四：配置管理

### 8. 技术要求
- **数据库**：SQLite，使用Sequelize ORM
- **后端**：Node.js + Express
- **前端**：HTML + CSS + JavaScript，使用Chart.js绘制图表
- **架构**：三层架构（数据层、服务层、表现层）
- **数据一致性**：使用事务确保主表和从表数据一致
- **性能优化**：质量数据预计算缓存，主界面查询使用索引优化

### 9. 用户体验
- **加载状态提示**：提升用户体验
- **表单验证**：确保数据有效性
- **操作确认**：删除评价周期、提交评价等操作需要确认
- **中途保存**：防止数据丢失

### 10. 扩展性
- **JSON字段**：存储自定义维度和分数，支持灵活扩展
- **配置管理独立**：便于后续添加更多配置项
- **API遵循RESTful规范**：便于移动端集成

## 设计决策总结

1. **实施策略**：快速迭代，先实现核心功能
2. **质量数据提取**：预计算缓存，避免重复计算
3. **评价配置**：完整配置管理，支持维度和等级自定义
4. **数据存储**：多表关联，支持灵活查询和统计
5. **评价周期**：系统预设标准周期（月度/季度/年度）
6. **评价流程**：单次评价 + 中途保存
7. **主界面展示**：混合模式，默认显示最新，支持周期切换
8. **界面设计**：主界面用于查看，评价界面用于操作，职责分离

## 关键约束

- 不需要Excel/PDF导出功能
- 主界面不包括评价操作和评分规则显示
- 评价完成后结果保存为快照，不受后续数据变更影响
- 评价维度支持自定义，使用JSON字段存储
- 数据库表名避免使用"Supplier"前缀（因为Supplier在软件中代表供应商资料管理模块）