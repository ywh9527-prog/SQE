# 交互指南：AskUserQuestion 最佳实践

本文档指导如何在 Skill 中有效使用 `AskUserQuestion` 工具与用户交互。

## 目录

- [AskUserQuestion 参数格式](#askuserquestion-参数格式)
- [何时使用交互](#何时使用交互)
- [问题设计原则](#问题设计原则)
- [常用交互模板](#常用交互模板)
- [避免的反模式](#避免的反模式)

---

## AskUserQuestion 参数格式

### 正确的 JSON 参数格式

```json
{
  "questions": [{
    "question": "问题内容？",
    "header": "短标签",
    "options": [
      {"label": "选项文字", "description": "选项说明"},
      {"label": "选项文字", "description": "选项说明"}
    ],
    "multiSelect": false
  }]
}
```

### 参数说明

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `questions` | array | 是 | 问题数组，1-4 个问题 |
| `question` | string | 是 | 完整的问题内容，以问号结尾 |
| `header` | string | 是 | **最多 12 字符！** 显示为标签 |
| `options` | array | 是 | 选项数组，**必须 2-4 个** |
| `label` | string | 是 | 选项显示文字，1-5 个词 |
| `description` | string | 是 | 选项说明，解释含义 |
| `multiSelect` | boolean | 是 | true 允许多选，false 单选 |

### 常见错误

| 错误 | 问题 | 正确做法 |
|------|------|----------|
| header 超长 | `"header": "这是一个很长的标签"` | 缩短到 12 字符内：`"header": "标签"` |
| options 太少 | 只有 1 个选项 | 至少提供 2 个选项 |
| options 太多 | 超过 4 个选项 | 最多 4 个，多了分步询问 |
| 缺少 description | `{"label": "选项"}` | 必须加：`{"label": "选项", "description": "说明"}` |
| multiSelect 缺失 | 没有这个字段 | 必须显式指定 true 或 false |

### 完整示例

**单选问题：**
```json
{
  "questions": [{
    "question": "这个 Skill 你想在哪里用？",
    "header": "作用域",
    "options": [
      {"label": "当前项目", "description": "仅在当前项目可用"},
      {"label": "所有项目", "description": "全局可用，任何项目都能调用"}
    ],
    "multiSelect": false
  }]
}
```

**多选问题：**
```json
{
  "questions": [{
    "question": "这个 Skill 需要哪些资源？",
    "header": "资源类型",
    "options": [
      {"label": "脚本", "description": "可执行的 Python/Bash 脚本"},
      {"label": "文档", "description": "参考文档或 API 说明"},
      {"label": "模板", "description": "输出模板或素材文件"},
      {"label": "无需额外", "description": "只需要 SKILL.md"}
    ],
    "multiSelect": true
  }]
}
```

**多个问题（一次最多 4 个）：**
```json
{
  "questions": [
    {
      "question": "Skill 作用域？",
      "header": "作用域",
      "options": [
        {"label": "项目级", "description": "当前项目"},
        {"label": "全局级", "description": "所有项目"}
      ],
      "multiSelect": false
    },
    {
      "question": "你用的是什么工具？",
      "header": "工具",
      "options": [
        {"label": "Claude Code", "description": "命令行工具"},
        {"label": "其他", "description": "Cursor/Trae 等"}
      ],
      "multiSelect": false
    }
  ]
}
```

---

## 何时使用交互

### 必须交互的场景

| 场景 | 原因 | 示例 |
|------|------|------|
| 关键决策点 | 避免走错方向 | 技术方案选择 |
| 需要用户输入 | 无法自动获取 | API Key、文件路径 |
| 不可逆操作前 | 防止误操作 | 删除文件、覆盖数据 |
| 多种有效方案 | 尊重用户偏好 | 输出格式选择 |
| 阶段完成确认 | 确保方向正确 | 蓝图确认、结果验证 |

### 不需要交互的场景

| 场景 | 原因 |
|------|------|
| 有明确最佳实践 | 直接执行即可 |
| 可自动推断 | 从上下文获取 |
| 可撤销的操作 | 错了可以改 |
| 技术细节 | 用户不需要关心 |

---

## 问题设计原则

### 1. 问题要具体明确

**好的问题:**
```
问题: "这个 Skill 的作用域是？"
选项:
- "项目级 - 仅当前项目可用"
- "全局级 - 所有项目可用"
```

**差的问题:**
```
问题: "你想怎么配置？"
选项:
- "方式1"
- "方式2"
```

### 2. 选项要互斥且完整

**好的设计:**
```
问题: "输出格式？"
选项:
- "Markdown"
- "JSON"
- "纯文本"
- "其他 (请说明)"  // 兜底选项
```

**差的设计:**
```
问题: "输出格式？"
选项:
- "Markdown"
- "文本格式"  // 与 Markdown 重叠
// 缺少兜底选项
```

### 3. 选项数量适中 (2-4个)

- 2个选项：二选一决策
- 3个选项：常见场景 + 兜底
- 4个选项：最大推荐数量

超过4个选项时，考虑分步询问或重新分类。

### 4. 提供足够上下文

**好的做法:**
```
问题: "检测到项目使用 React，前端框架选择？"
选项:
- "React (推荐 - 与现有项目一致)"
- "Vue"
- "原生 JavaScript"
```

**差的做法:**
```
问题: "框架？"
选项:
- "React"
- "Vue"
- "JS"
```

### 5. 推荐选项放第一位

```
问题: "数据库选择？"
选项:
- "PostgreSQL (推荐 - 功能全面)"  // 推荐项在前
- "MySQL"
- "SQLite"
```

---

## 常用交互模板

### 需求澄清类

```
问题: "这个 Skill 的核心功能是什么？"
选项:
- "处理特定文件格式 (PDF/Excel/Word等)"
- "连接外部服务或 API"
- "执行特定领域的工作流程"
- "其他 (请描述)"
```

### 技术方案类

```
问题: "实现 [功能] 的技术方案？"
选项:
- "方案A: [具体描述] (推荐)"
- "方案B: [具体描述]"
- "我有其他想法"
```

### 配置选择类

```
问题: "Skill 作用域？"
选项:
- "项目级 - 存放在 ./.claude/skills/"
- "全局级 - 存放在 ~/.claude/skills/"
```

### 确认类

```
问题: "以上架构蓝图是否符合预期？"
选项:
- "符合，继续实现"
- "需要调整 (请说明)"
- "不对，重新描述需求"
```

### 资源需求类 (多选)

```
问题: "这个 Skill 需要哪些资源？"
选项 (多选):
- "scripts/ - 可执行脚本"
- "references/ - 参考文档"
- "assets/ - 输出资源"
- "不需要额外资源"
```

### 测试选择类

```
问题: "选择测试案例："
选项:
- "正常路径: [描述]"
- "边缘情况: [描述]"
- "跳过测试"
```

### 结果反馈类

```
问题: "测试结果如何？"
选项:
- "完美，已完成"
- "需要调整 (请描述)"
- "需要重新设计"
```

### 异常处理类

```
问题: "遇到问题: [错误描述]，如何处理？"
选项:
- "跳过，继续其他"
- "尝试替代方案"
- "停止，等待修复"
```

---

## 交互流程设计

### 渐进式询问

不要一次问太多问题，按阶段逐步询问：

```
阶段1: 核心需求
  ↓
阶段2: 技术方案
  ↓
阶段3: 配置细节
  ↓
阶段4: 确认执行
```

### 分支询问

根据前一个回答决定下一个问题：

```
Q1: "Skill 类型？"
  → "文件处理" → Q2a: "什么文件格式？"
  → "API 集成" → Q2b: "什么 API？"
  → "工作流程" → Q2c: "什么领域？"
```

### 确认循环

关键步骤后确认，不满意则回退：

```
执行步骤 → 展示结果 → 询问确认
                         ↓
              满意 → 继续下一步
              不满意 → 回退修改
```

---

## 避免的反模式

### 1. 过度询问

**反模式:** 每个小决定都问用户
**正确做法:** 只在关键决策点询问

### 2. 模糊选项

**反模式:** "选项1", "选项2", "其他"
**正确做法:** 清晰描述每个选项的含义

### 3. 缺少兜底

**反模式:** 只提供固定选项，用户无法表达其他需求
**正确做法:** 总是包含 "其他 (请说明)" 选项

### 4. 技术术语堆砌

**反模式:** "使用 REST API 还是 GraphQL with Apollo Client?"
**正确做法:** "数据获取方式？A: 传统方式 (简单) B: 现代方式 (灵活)"

### 5. 假设用户懂技术

**反模式:** 直接问技术细节
**正确做法:** 先解释背景，再提供选项

---

## 小白友好原则

1. **解释术语**: 技术词汇后加简短说明
2. **给出推荐**: 不确定时告诉用户推荐选项
3. **提供示例**: 抽象概念配具体例子
4. **允许不知道**: 提供 "帮我决定" 选项
5. **渐进深入**: 从简单问题开始，逐步深入

```
问题: "你熟悉命令行操作吗？"
选项:
- "熟悉 - 我可以自己运行脚本"
- "一般 - 需要具体指令"
- "不熟悉 - 请详细指导每一步"
```
