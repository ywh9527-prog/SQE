# 工作流模式参考

本文档提供 Skill 中常用的工作流设计模式。

## 目录

- [顺序工作流](#顺序工作流)
- [条件工作流](#条件工作流)
- [反馈循环](#反馈循环)
- [检查清单模式](#检查清单模式)

---

## 顺序工作流

适用于有明确步骤顺序的任务。

### 基本模式

```markdown
## PDF 表单填写流程

1. 分析表单 (运行 analyze_form.py)
2. 创建字段映射 (编辑 fields.json)
3. 验证映射 (运行 validate_fields.py)
4. 填写表单 (运行 fill_form.py)
5. 验证输出 (运行 verify_output.py)
```

### 带检查点的模式

```markdown
## 文档处理流程

**步骤 1: 分析文档**
运行: `python scripts/analyze.py input.pdf`
✓ 检查点: 确认输出 fields.json 存在

**步骤 2: 验证字段**
运行: `python scripts/validate.py fields.json`
✓ 检查点: 无错误输出

**步骤 3: 处理文档**
运行: `python scripts/process.py input.pdf fields.json output.pdf`
✓ 检查点: 输出文件可正常打开
```

---

## 条件工作流

适用于需要根据情况选择不同路径的任务。

### 决策树模式

```markdown
## 文档修改工作流

1. 确定修改类型:

   **创建新内容?** → 执行 "创建工作流"
   **编辑现有内容?** → 执行 "编辑工作流"

2. 创建工作流:
   - 使用 docx-js 库
   - 从头构建文档
   - 导出为 .docx 格式

3. 编辑工作流:
   - 解压现有文档
   - 直接修改 XML
   - 每次修改后验证
   - 完成后重新打包
```

### 多分支模式

```markdown
## 图片处理工作流

根据用户需求选择处理路径:

| 用户需求 | 处理路径 | 使用工具 |
|----------|----------|----------|
| 调整大小 | resize_workflow | PIL/Pillow |
| 格式转换 | convert_workflow | PIL/Pillow |
| 添加水印 | watermark_workflow | PIL + 自定义脚本 |
| OCR 识别 | ocr_workflow | pytesseract |
```

---

## 反馈循环

适用于需要验证和迭代的任务。

### 验证-修复循环

```markdown
## 内容审核流程

1. 起草内容
2. 对照检查清单审核:
   - 检查术语一致性
   - 验证示例格式
   - 确认必需章节存在
3. 如发现问题:
   - 记录具体问题位置
   - 修改内容
   - 重新审核
4. 所有要求满足后继续
5. 保存最终文档
```

### 脚本验证循环

```markdown
## 文档编辑流程

1. 编辑 `word/document.xml`
2. **立即验证**: `python scripts/validate.py unpacked_dir/`
3. 如验证失败:
   - 仔细阅读错误信息
   - 修复 XML 中的问题
   - 再次运行验证
4. **仅在验证通过后继续**
5. 重建: `python scripts/pack.py unpacked_dir/ output.docx`
6. 测试输出文档
```

---

## 检查清单模式

适用于复杂多步骤任务，帮助跟踪进度。

### 可复制检查清单

```markdown
## 研究综合工作流

复制此检查清单并跟踪进度:

```
研究进度:
- [ ] 步骤 1: 阅读所有源文档
- [ ] 步骤 2: 识别关键主题
- [ ] 步骤 3: 交叉引用论点
- [ ] 步骤 4: 创建结构化摘要
- [ ] 步骤 5: 验证引用
```

**步骤 1: 阅读所有源文档**
审阅 `sources/` 目录中的每个文档，记录主要论点和支持证据。

**步骤 2: 识别关键主题**
寻找跨源文档的模式。哪些主题反复出现？源文档在哪些方面一致或不一致？

...
```

### 带状态的检查清单

```markdown
## 部署检查清单

```
部署状态:
- [x] 代码审查完成
- [x] 测试通过
- [ ] 配置更新
- [ ] 数据库迁移
- [ ] 部署到预发布环境
- [ ] 冒烟测试
- [ ] 部署到生产环境
```

当前步骤: 配置更新
阻塞问题: 无
```

---

## 使用 AskUserQuestion 的交互模式

在工作流中适时询问用户，确保方向正确。

### 关键决策点询问

```
问题: "文档处理完成，下一步操作？"
选项:
- "保存并继续下一个文档"
- "修改当前结果"
- "放弃更改"
```

### 验证结果询问

```
问题: "处理结果如下 [展示结果]，是否符合预期？"
选项:
- "符合预期，继续"
- "需要调整 (请说明)"
- "完全不对，重新开始"
```

### 异常处理询问

```
问题: "遇到以下问题: [错误描述]，如何处理？"
选项:
- "跳过此项，继续处理其他"
- "尝试替代方案"
- "停止处理，等待修复"
```
