# 供应商资料管理系统 v3.1 实施计划

**创建时间**: 2025-12-02  
**版本**: v3.1 (基于 v3.0 优化)  
**目标**: 实现表格预览 + 展开详情的混合视图

---

## 🎯 核心改进

### 1. 层级结构调整

**原结构** (v3.0):
```
供应商 → 物料 → 构成 → 资料
```

**新结构** (v3.1):
```
供应商 → 物料 → 资料(构成备注)
```

**关键变化**:
- ✅ 构成不再是独立层级，而是作为资料的备注
- ✅ 例如: `ROHS (成分A)` 和 `ROHS (成分B)` 都显示在物料下

### 2. 术语调整

- ❌ "供应商级资料" → ✅ "通用资料"

### 3. 视图设计

#### 表格预览 (顶层)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│ 供应商     │ MSDS      │ 质量协议   │ ROHS    │ REACH   │ HF      │ 物料 │ 操作 │
├────────────────────────────────────────────────────────────────────────────────┤
│ 深圳XX电子 │ 2025-12-30│ 2026-01-15│ 3份 🟡  │ 2份 🔴  │ 3份 🟢  │ 2个 │ 📂  │
│            │ 🟢 30天   │ 🟢 45天   │         │         │         │     │     │
└────────────────────────────────────────────────────────────────────────────────┘
```

**字段说明**:
- **MSDS / 质量协议**: 显示到期日期 + 剩余天数 + 状态
- **ROHS / REACH / HF**: 显示数量 + 最差状态
- **物料**: 显示物料数量
- **操作**: 展开/收起按钮

#### 展开详情 (点击后)

```
📂 深圳XX电子 (展开)
  
  📋 通用资料
    ├─ MSDS: 2025-12-30 (剩余30天) 🟢
    └─ 质量协议: 2026-01-15 (剩余45天) 🟢
  
  🏭 物料: 电木粉
    ├─ ROHS (成分A): 2025-11-20 (剩余18天) 🟡
    ├─ ROHS (成分B): 2025-12-10 (剩余8天) 🟡
    ├─ REACH (成分A): 2025-10-05 (已过期3天) 🔴
    └─ HF (成分B): 2026-01-01 (剩余30天) 🟢
  
  🏭 物料: PIN脚
    ├─ ROHS (铜材): 2025-12-25 (剩余23天) 🟢
    ├─ REACH (铜材): 缺失 ❌
    └─ HF (铜材): 2026-02-10 (剩余70天) 🟢
```

---

## 📝 需要修改的文件

### 后端

1. **server/routes/suppliers-tree.js**
   - 调整数据返回格式
   - 将构成信息合并到资料中

### 前端

1. **public/js/modules/supplier.js**
   - 重构渲染逻辑
   - 实现表格预览视图
   - 实现展开详情视图
   - 添加展开/收起交互

2. **public/css/modules/supplier-table.css** (新建)
   - 表格样式
   - 展开动画
   - 状态颜色

---

## 🔄 实施顺序

1. ✅ 创建实施计划文档
2. ⬜ 修改后端API (suppliers-tree.js)
3. ⬜ 重构前端渲染 (supplier.js)
4. ⬜ 创建新CSS样式 (supplier-table.css)
5. ⬜ 测试功能
6. ⬜ 优化细节

---

## 📊 数据结构示例

### API返回格式 (v3.1)

```json
{
  "success": true,
  "data": [
    {
      "supplierId": 1,
      "supplierName": "深圳XX电子",
      "contactPerson": "张三",
      "contactEmail": "zhang@example.com",
      "status": "warning",
      "materialCount": 2,
      "commonDocuments": [
        {
          "documentType": "environmental_msds",
          "documentName": "MSDS-2024",
          "expiryDate": "2025-12-30",
          "daysUntilExpiry": 30,
          "warningLevel": "normal"
        },
        {
          "documentType": "quality_agreement",
          "documentName": "质量协议-2024",
          "expiryDate": "2026-01-15",
          "daysUntilExpiry": 45,
          "warningLevel": "normal"
        }
      ],
      "materials": [
        {
          "materialId": 101,
          "materialName": "电木粉",
          "documents": [
            {
              "documentType": "environmental_rohs",
              "documentName": "ROHS报告",
              "componentName": "成分A",
              "expiryDate": "2025-11-20",
              "daysUntilExpiry": 18,
              "warningLevel": "warning"
            },
            {
              "documentType": "environmental_rohs",
              "documentName": "ROHS报告",
              "componentName": "成分B",
              "expiryDate": "2025-12-10",
              "daysUntilExpiry": 8,
              "warningLevel": "warning"
            }
          ],
          "documentStats": {
            "rohs": { "count": 2, "worstStatus": "warning" },
            "reach": { "count": 1, "worstStatus": "urgent" },
            "hf": { "count": 1, "worstStatus": "normal" }
          }
        }
      ]
    }
  ]
}
```

---

## ✅ 验收标准

1. ✅ 表格预览正确显示所有供应商
2. ✅ MSDS/质量协议显示到期日期和剩余天数
3. ✅ ROHS/REACH/HF显示数量和最差状态
4. ✅ 点击展开按钮能正确展开/收起
5. ✅ 展开后显示通用资料和物料资料
6. ✅ 构成信息作为括号备注显示
7. ✅ 状态颜色正确 (🟢🟡🔴❌)
8. ✅ 响应式设计，适配不同屏幕

---

**开始实施时间**: 2025-12-02 20:15  
**预计完成时间**: 2025-12-02 22:00
