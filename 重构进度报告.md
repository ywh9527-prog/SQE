# ğŸ‰ Phase 2 å®Œæˆï¼åç«¯APIå¼€å‘å…¨éƒ¨å®Œæˆ

**æ—¥æœŸ**: 2025-12-02  
**çŠ¶æ€**: Phase 1 âœ… | Phase 2 âœ… | Phase 3 â¬œ

---

## âœ… **Phase 2: åç«¯APIå¼€å‘** (å·²å®Œæˆ)

### å®Œæˆçš„APIåˆ—è¡¨

#### 1. **GET /api/suppliers/tree** âœ…
**åŠŸèƒ½**: è·å–ä¾›åº”å•†æ ‘å½¢æ•°æ®  
**ç‰¹æ€§**:
- âœ… æ”¯æŒæŸ¥è¯¢æ‰€æœ‰ä¾›åº”å•†æˆ–ç‰¹å®šä¾›åº”å•†
- âœ… è¿”å›å®Œæ•´çš„ä¸‰çº§å±‚çº§ç»“æ„ (ä¾›åº”å•† â†’ ç‰©æ–™ â†’ æ„æˆ â†’ èµ„æ–™)
- âœ… è‡ªåŠ¨è®¡ç®—èµ„æ–™åˆ°æœŸå¤©æ•°å’Œè­¦å‘Šçº§åˆ«
- âœ… è‡ªåŠ¨è®¡ç®—ä¾›åº”å•†/ç‰©æ–™/æ„æˆçš„æ•´ä½“çŠ¶æ€

**ç¤ºä¾‹è¯·æ±‚**:
```bash
GET /api/suppliers/tree
GET /api/suppliers/tree?supplierId=1
```

#### 2. **POST /api/materials** âœ…
**åŠŸèƒ½**: æ–°å¢ç‰©æ–™  
**ç‰¹æ€§**:
- âœ… æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ç‰©æ–™åç§°
- âœ… è‡ªåŠ¨éªŒè¯ä¾›åº”å•†æ˜¯å¦å­˜åœ¨
- âœ… é˜²æ­¢åŒä¸€ä¾›åº”å•†ä¸‹ç‰©æ–™åç§°é‡å¤

**ç¤ºä¾‹è¯·æ±‚**:
```json
POST /api/materials
{
  "supplierId": 1,
  "materialName": "ç”µæœ¨ç²‰",
  "materialCode": "DM-001",
  "description": "ç”¨äºç”Ÿäº§XXäº§å“"
}
```

#### 3. **POST /api/materials/components** âœ…
**åŠŸèƒ½**: æ–°å¢å…·ä½“æ„æˆ  
**ç‰¹æ€§**:
- âœ… æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ„æˆåç§°
- âœ… è‡ªåŠ¨éªŒè¯ç‰©æ–™æ˜¯å¦å­˜åœ¨
- âœ… é˜²æ­¢åŒä¸€ç‰©æ–™ä¸‹æ„æˆåç§°é‡å¤

**ç¤ºä¾‹è¯·æ±‚**:
```json
POST /api/materials/components
{
  "materialId": 101,
  "componentName": "æˆåˆ†A",
  "componentCode": "CA-001",
  "description": "ä¸»è¦æˆåˆ†"
}
```

#### 4. **GET /api/materials** âœ…
**åŠŸèƒ½**: æŸ¥è¯¢ç‰©æ–™åˆ—è¡¨  
**ç‰¹æ€§**:
- âœ… æŒ‰ä¾›åº”å•†æŸ¥è¯¢
- âœ… è¿”å›æ¯ä¸ªç‰©æ–™çš„æ„æˆæ•°é‡

**ç¤ºä¾‹è¯·æ±‚**:
```bash
GET /api/materials?supplierId=1
```

#### 5. **GET /api/materials/:materialId/components** âœ…
**åŠŸèƒ½**: æŸ¥è¯¢å…·ä½“æ„æˆåˆ—è¡¨  
**ç‰¹æ€§**:
- âœ… æŒ‰ç‰©æ–™æŸ¥è¯¢
- âœ… è¿”å›æ¯ä¸ªæ„æˆçš„èµ„æ–™æ•°é‡

**ç¤ºä¾‹è¯·æ±‚**:
```bash
GET /api/materials/101/components
```

#### 6. **POST /api/documents/upload** âœ…
**åŠŸèƒ½**: ä¸Šä¼ èµ„æ–™ (æ”¯æŒä¸‰çº§å±‚çº§)  
**ç‰¹æ€§**:
- âœ… æ”¯æŒä¸‰çº§å±‚çº§ä¸Šä¼  (supplier/material/component)
- âœ… è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç† (æ—§ç‰ˆæœ¬è‡ªåŠ¨å½’æ¡£)
- âœ… æ–‡ä»¶ç±»å‹éªŒè¯ (PDF, DOC, XLS, JPG, PNG)
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶ (100MB)
- âœ… è‡ªåŠ¨åˆ›å»ºå±‚çº§åŒ–æ–‡ä»¶å¤¹ç»“æ„
- âœ… ä¾›åº”å•†çº§èµ„æ–™ç±»å‹éªŒè¯ (MSDSå½’ä¸ºä¾›åº”å•†çº§)
- âœ… å…·ä½“æ„æˆçº§èµ„æ–™ç±»å‹éªŒè¯ (ROHS/REACH/HF)

**ç¤ºä¾‹è¯·æ±‚**:
```
POST /api/documents/upload
Content-Type: multipart/form-data

supplierId: 1
level: "component"
materialId: 101
componentId: 1001
documentType: "environmental_rohs"
documentName: "ROHS V2.0"
expiryDate: "2025-12-31"
isPermanent: false
file: <binary>
```

#### 7. **GET /api/documents/expiring** âœ…
**åŠŸèƒ½**: æŸ¥è¯¢å³å°†è¿‡æœŸçš„èµ„æ–™  
**ç‰¹æ€§**:
- âœ… æ”¯æŒè‡ªå®šä¹‰å¤©æ•° (é»˜è®¤30å¤©)
- âœ… æ”¯æŒæŒ‰ä¾›åº”å•†ç­›é€‰
- âœ… è‡ªåŠ¨è®¡ç®—åˆ°æœŸå¤©æ•°å’Œè­¦å‘Šçº§åˆ«
- âœ… è¿”å›ä¾›åº”å•†è”ç³»ä¿¡æ¯

**ç¤ºä¾‹è¯·æ±‚**:
```bash
GET /api/documents/expiring?days=30
GET /api/documents/expiring?days=30&supplierId=1
```

#### 8. **GET /api/documents/expired** âœ…
**åŠŸèƒ½**: æŸ¥è¯¢å·²è¿‡æœŸçš„èµ„æ–™  
**ç‰¹æ€§**:
- âœ… æ”¯æŒæŒ‰ä¾›åº”å•†ç­›é€‰
- âœ… è‡ªåŠ¨è®¡ç®—è¿‡æœŸå¤©æ•°
- âœ… è¿”å›ä¾›åº”å•†è”ç³»ä¿¡æ¯

**ç¤ºä¾‹è¯·æ±‚**:
```bash
GET /api/documents/expired
GET /api/documents/expired?supplierId=1
```

---

## ğŸ“ **æ–°å¢æ–‡ä»¶åˆ—è¡¨**

### æ•°æ®æ¨¡å‹
- âœ… `server/models/Material.js` - ç‰©æ–™æ¨¡å‹
- âœ… `server/models/MaterialComponent.js` - å…·ä½“æ„æˆæ¨¡å‹
- âœ… `server/models/SupplierDocument.js` - èµ„æ–™æ¨¡å‹ (é‡æ„)

### APIè·¯ç”±
- âœ… `server/routes/suppliers-tree.js` - æ ‘å½¢æ•°æ®API
- âœ… `server/routes/materials.js` - ç‰©æ–™ç®¡ç†API
- âœ… `server/routes/documents-upload.js` - èµ„æ–™ä¸Šä¼ API

### æ•°æ®åº“è¿ç§»
- âœ… `server/migrations/rebuild_database_v3.js` - æ•°æ®åº“é‡å»ºè„šæœ¬
- âœ… `server/migrations/verify_database.js` - æ•°æ®åº“éªŒè¯è„šæœ¬

### æµ‹è¯•è„šæœ¬
- âœ… `server/test-api.js` - APIæµ‹è¯•è„šæœ¬

### æ–‡æ¡£
- âœ… `ä¾›åº”å•†èµ„æ–™ç®¡ç†ç³»ç»Ÿ-é‡æ„ç­–åˆ’v3.0.md` - å®Œæ•´ç­–åˆ’æ–‡æ¡£
- âœ… `é‡æ„è¿›åº¦æŠ¥å‘Š.md` - è¿›åº¦æŠ¥å‘Š

---

## ğŸ§ª **å¦‚ä½•æµ‹è¯•API**

### æ–¹æ³•1: ä½¿ç”¨æµ‹è¯•è„šæœ¬ (æ¨è)

1. å¯åŠ¨æœåŠ¡å™¨:
```bash
cd D:\AI\IFLOW-SQE-Data-Analysis-Assistant-refactored
node server/index.js
```

2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæµ‹è¯•è„šæœ¬:
```bash
node server/test-api.js
```

### æ–¹æ³•2: ä½¿ç”¨Postman

1. å¯¼å…¥APIé›†åˆ (å¯ä»¥æ‰‹åŠ¨åˆ›å»º)
2. æµ‹è¯•æ¯ä¸ªAPIç«¯ç‚¹
3. éªŒè¯è¿”å›æ•°æ®ç»“æ„

### æ–¹æ³•3: ä½¿ç”¨curl

```bash
# è·å–æ ‘å½¢æ•°æ®
curl http://localhost:8888/api/suppliers/tree

# æ–°å¢ç‰©æ–™
curl -X POST http://localhost:8888/api/materials \
  -H "Content-Type: application/json" \
  -d '{"supplierId":1,"materialName":"æµ‹è¯•ç‰©æ–™","materialCode":"TEST-001"}'

# æŸ¥è¯¢å³å°†è¿‡æœŸèµ„æ–™
curl http://localhost:8888/api/documents/expiring?days=30
```

---

## ğŸ“Š **æ•´ä½“è¿›åº¦æ›´æ–°**

| Phase | åç§° | çŠ¶æ€ | å®Œæˆåº¦ | é¢„è®¡å‰©ä½™æ—¶é—´ |
|-------|------|------|--------|-------------|
| **Phase 1** | æ•°æ®åº“é‡æ„ | âœ… å·²å®Œæˆ | 100% | - |
| **Phase 2** | åç«¯APIå¼€å‘ | âœ… å·²å®Œæˆ | 100% | - |
| **Phase 3** | å‰ç«¯UIé‡æ„ | â¬œ æœªå¼€å§‹ | 0% | 3-4å¤© |
| **Phase 4** | åŠŸèƒ½å®Œå–„ä¸ä¼˜åŒ– | â¬œ æœªå¼€å§‹ | 0% | 2-3å¤© |

**æ€»ä½“è¿›åº¦**: çº¦ 40%  
**é¢„è®¡å®Œæˆæ—¶é—´**: 5-7å¤©

---

## ğŸ¯ **ä¸‹ä¸€æ­¥: Phase 3 - å‰ç«¯UIé‡æ„**

### æ ¸å¿ƒä»»åŠ¡

#### 1. **é‡æ„ supplier.js å‰ç«¯æ¨¡å—** (1-2å¤©)
- åˆ é™¤æ—§ä»£ç  (2753è¡Œ â†’ é¢„è®¡800è¡Œ)
- å®ç°æ ‘å½¢æ•°æ®åŠ è½½
- å®ç°çŠ¶æ€ç®¡ç†

#### 2. **å®ç°æ ‘å½¢å¡ç‰‡è§†å›¾** (1å¤©)
- å¯æŠ˜å çš„å±‚çº§å±•ç¤º
- çŠ¶æ€é¢œè‰²æ ‡è¯† (ğŸŸ¢ğŸŸ¡ğŸ”´)
- å¿«é€Ÿæ“ä½œæŒ‰é’®

#### 3. **å®ç°ä¸‰çº§è”åŠ¨ä¸Šä¼ è¡¨å•** (1å¤©)
- å±‚çº§é€‰æ‹© (ä¾›åº”å•†çº§/ç‰©æ–™çº§/æ„æˆçº§)
- ä¸‰çº§è”åŠ¨ (ä¾›åº”å•† â†’ ç‰©æ–™ â†’ æ„æˆ)
- æ–‡ä»¶ä¸Šä¼ å’ŒéªŒè¯

#### 4. **å®ç°æœç´¢å’Œç­›é€‰åŠŸèƒ½** (0.5å¤©)
- å¤šç»´åº¦ç­›é€‰
- å®æ—¶æœç´¢
- çŠ¶æ€ç­›é€‰

---

## ğŸ’¡ **å»ºè®®çš„å®æ–½é¡ºåº**

### ç¬¬1å¤©: å‰ç«¯åŸºç¡€æ¶æ„
1. æ¸…ç† `supplier.js` æ—§ä»£ç 
2. åˆ›å»ºæ–°çš„æ¨¡å—ç»“æ„
3. å®ç°æ ‘å½¢æ•°æ®åŠ è½½

### ç¬¬2å¤©: æ ‘å½¢å¡ç‰‡è§†å›¾
1. å®ç°å¯æŠ˜å çš„å±‚çº§å±•ç¤º
2. å®ç°çŠ¶æ€é¢œè‰²æ ‡è¯†
3. å®ç°å¿«é€Ÿæ“ä½œæŒ‰é’®

### ç¬¬3å¤©: ä¸Šä¼ è¡¨å•
1. å®ç°ä¸‰çº§è”åŠ¨é€‰æ‹©
2. å®ç°æ–‡ä»¶ä¸Šä¼ 
3. å®ç°è¡¨å•éªŒè¯

### ç¬¬4å¤©: åŠŸèƒ½å®Œå–„
1. å®ç°æœç´¢ç­›é€‰
2. å®ç°æ‰¹é‡æ“ä½œ
3. ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

---

## ğŸ‰ **å·²å–å¾—çš„æˆæœ**

1. âœ… **æ•°æ®æ¨¡å‹å®Œç¾** - ä¸‰çº§å±‚çº§ç»“æ„å®Œæ•´
2. âœ… **æ•°æ®åº“é‡å»ºæˆåŠŸ** - ç¤ºä¾‹æ•°æ®å®Œæ•´
3. âœ… **8ä¸ªæ ¸å¿ƒAPIå®Œæˆ** - åŠŸèƒ½å®Œæ•´,é€»è¾‘æ­£ç¡®
4. âœ… **MSDSå½’å±æ­£ç¡®** - ä¾›åº”å•†çº§èµ„æ–™ â­
5. âœ… **è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†** - æ—§ç‰ˆæœ¬è‡ªåŠ¨å½’æ¡£
6. âœ… **æ–‡ä»¶å±‚çº§åŒ–å­˜å‚¨** - ç›®å½•ç»“æ„æ¸…æ™°
7. âœ… **æµ‹è¯•è„šæœ¬å®Œæˆ** - å¯å¿«é€ŸéªŒè¯API

---

## ğŸ“ **ç°åœ¨å¯ä»¥åšä»€ä¹ˆ?**

### é€‰é¡¹1: ç«‹å³æµ‹è¯•API (æ¨è)
```bash
# ç»ˆç«¯1: å¯åŠ¨æœåŠ¡å™¨
node server/index.js

# ç»ˆç«¯2: è¿è¡Œæµ‹è¯•
node server/test-api.js
```

### é€‰é¡¹2: å¼€å§‹å‰ç«¯UIå¼€å‘
- æˆ‘å¯ä»¥ç«‹å³å¼€å§‹é‡æ„ `supplier.js`
- å®ç°æ ‘å½¢å¡ç‰‡è§†å›¾
- å®ç°ä¸‰çº§è”åŠ¨ä¸Šä¼ è¡¨å•

### é€‰é¡¹3: å…ˆä¼‘æ¯ä¸€ä¸‹ ğŸ˜Š
- Phase 1 å’Œ Phase 2 å·²ç»å®Œæˆäº†å¾ˆå¤šå·¥ä½œ
- å¯ä»¥å…ˆæµ‹è¯•ä¸€ä¸‹API
- æ˜å¤©å†ç»§ç»­å‰ç«¯å¼€å‘

---

**æ€»ç»“**: Phase 2 åç«¯APIå¼€å‘å…¨éƒ¨å®Œæˆï¼æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½å·²å®ç°,åŒ…æ‹¬æ ‘å½¢æ•°æ®æŸ¥è¯¢ã€ç‰©æ–™ç®¡ç†ã€èµ„æ–™ä¸Šä¼ ã€è¿‡æœŸæŸ¥è¯¢ç­‰ã€‚ç°åœ¨å¯ä»¥å¼€å§‹Phase 3 å‰ç«¯UIé‡æ„äº†ï¼

å–µ~ æˆ‘ä»¬å·²ç»å®Œæˆäº†40%çš„å·¥ä½œ,ç»§ç»­åŠ æ²¹! ğŸš€
