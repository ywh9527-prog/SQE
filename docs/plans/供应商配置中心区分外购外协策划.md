# 供应商配置中心区分外购和外协策划文档

## 一、需求背景

### 1.1 当前问题
- **IQC质量分析模块**：已经区分了外购和外协（两个Excel文件）
- **供应商配置中心**：没有区分外购和外协，每个供应商只有一条记录
- **数据不一致**：导致供应商月度绩效评价模块无法准确提取数据

### 1.2 目标
- 在供应商配置中心添加 `data_type` 字段
- 允许同一供应商创建多条记录（不同data_type）
- 支持外购（purchase）和外协（external）两种类型
- 保持数据准确性和系统一致性

---

## 二、数据库设计

### 2.1 当前表结构

**表名**：`vendor_configs`

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 主键ID |
| supplier_name | STRING(255) | UNIQUE NOT NULL | 供应商名称（唯一） |
| source | STRING(50) | DEFAULT 'IQC' | 数据来源 |
| enable_document_mgmt | BOOLEAN | DEFAULT false | 是否启用资料管理 |
| enable_performance_mgmt | BOOLEAN | DEFAULT false | 是否启用绩效评价 |
| status | STRING(20) | DEFAULT 'Inactive' | 状态 |
| created_at | DATE | DEFAULT NOW | 创建时间 |
| updated_at | DATE | DEFAULT NOW | 更新时间 |

### 2.2 修改后的表结构

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 主键ID |
| supplier_name | STRING(255) | NOT NULL | 供应商名称 |
| data_type | ENUM('purchase', 'external') | NOT NULL DEFAULT 'purchase' | 数据类型（外购/外协） |
| source | STRING(50) | DEFAULT 'IQC' | 数据来源 |
| enable_document_mgmt | BOOLEAN | DEFAULT false | 是否启用资料管理 |
| enable_performance_mgmt | BOOLEAN | DEFAULT false | 是否启用绩效评价 |
| status | STRING(20) | DEFAULT 'Inactive' | 状态 |
| created_at | DATE | DEFAULT NOW | 创建时间 |
| updated_at | DATE | DEFAULT NOW | 更新时间 |

### 2.3 索引修改

**当前索引**：
```sql
UNIQUE INDEX `idx_vendor_config_supplier_name` ON `vendor_configs` (`supplier_name`)
```

**修改后索引**：
```sql
-- 移除旧的唯一索引
DROP INDEX `idx_vendor_config_supplier_name` ON `vendor_configs`;

-- 添加新的复合唯一索引
UNIQUE INDEX `idx_vendor_config_supplier_name_type` ON `vendor_configs` (`supplier_name`, `data_type`);

-- 添加data_type索引
INDEX `idx_vendor_config_data_type` ON `vendor_configs` (`data_type`);
```

---

## 三、数据迁移方案

### 3.1 迁移步骤

#### 步骤1：添加data_type字段
```sql
ALTER TABLE `vendor_configs` 
ADD COLUMN `data_type` ENUM('purchase', 'external') NOT NULL DEFAULT 'purchase' 
AFTER `supplier_name`;
```

#### 步骤2：移除旧的唯一索引
```sql
ALTER TABLE `vendor_configs` 
DROP INDEX `idx_vendor_config_supplier_name`;
```

#### 步骤3：添加新的复合唯一索引
```sql
ALTER TABLE `vendor_configs` 
ADD UNIQUE INDEX `idx_vendor_config_supplier_name_type` (`supplier_name`, `data_type`);
```

#### 步骤4：添加data_type索引
```sql
ALTER TABLE `vendor_configs` 
ADD INDEX `idx_vendor_config_data_type` (`data_type`);
```

### 3.2 迁移脚本

**文件**：`server/migrations/add_data_type_to_vendor_config.js`

```javascript
const { sequelize } = require('../database/config.js');
const VendorConfig = require('../models/VendorConfig.js');

async function migrate() {
    try {
        console.log('开始迁移：添加data_type字段到vendor_configs表...');
        
        // 执行SQL迁移
        await sequelize.query(`
            ALTER TABLE vendor_configs 
            ADD COLUMN data_type ENUM('purchase', 'external') NOT NULL DEFAULT 'purchase' 
            AFTER supplier_name
        `);
        console.log('✓ 添加data_type字段');
        
        await sequelize.query(`
            ALTER TABLE vendor_configs 
            DROP INDEX idx_vendor_config_supplier_name
        `);
        console.log('✓ 移除旧的唯一索引');
        
        await sequelize.query(`
            ALTER TABLE vendor_configs 
            ADD UNIQUE INDEX idx_vendor_config_supplier_name_type (supplier_name, data_type)
        `);
        console.log('✓ 添加新的复合唯一索引');
        
        await sequelize.query(`
            ALTER TABLE vendor_configs 
            ADD INDEX idx_vendor_config_data_type (data_type)
        `);
        console.log('✓ 添加data_type索引');
        
        console.log('迁移完成！');
        
        // 验证迁移结果
        const count = await VendorConfig.count();
        console.log(`当前共有 ${count} 条供应商配置记录`);
        
        await sequelize.close();
    } catch (error) {
        console.error('迁移失败:', error);
        process.exit(1);
    }
}

migrate();
```

---

## 四、后端修改

### 4.1 修改VendorConfig模型

**文件**：`server/models/VendorConfig.js`

**修改内容**：
```javascript
data_type: {
    type: DataTypes.ENUM('purchase', 'external'),
    allowNull: false,
    defaultValue: 'purchase',
    comment: '数据类型：purchase-外购, external-外协'
},
```

**修改索引定义**：
```javascript
indexes: [
    {
        name: 'idx_vendor_config_supplier_name',
        fields: ['supplier_name']  // 移除unique
    },
    {
        name: 'idx_vendor_config_data_type',
        fields: ['data_type']
    },
    {
        name: 'idx_vendor_config_supplier_name_type',
        fields: ['supplier_name', 'data_type'],
        unique: true  // 新增复合唯一索引
    },
    // ... 其他索引
]
```

### 4.2 修改API路由

#### 4.2.1 获取供应商列表API
**文件**：`server/routes/vendors.js`

**修改内容**：
```javascript
// 获取供应商列表（按data_type分组）
router.get('/', authenticateToken, async (req, res) => {
    try {
        const vendors = await VendorConfig.findAll({
            order: [['supplier_name', 'ASC'], ['data_type', 'ASC']]
        });
        
        // 按供应商名称分组
        const vendorGroups = {};
        vendors.forEach(v => {
            if (!vendorGroups[v.supplier_name]) {
                vendorGroups[v.supplier_name] = [];
            }
            vendorGroups[v.supplier_name].push(v);
        });
        
        res.json({
            success: true,
            data: {
                vendors,
                vendorGroups
            }
        });
    } catch (error) {
        console.error('获取供应商列表失败:', error);
        res.status(500).json({
            success: false,
            message: '获取供应商列表失败'
        });
    }
});
```

#### 4.2.2 创建供应商API
**文件**：`server/routes/vendors.js`

**修改内容**：
```javascript
// 创建供应商
router.post('/', authenticateToken, async (req, res) => {
    try {
        const { supplier_name, data_type, source, enable_document_mgmt, enable_performance_mgmt } = req.body;
        
        // 验证必填字段
        if (!supplier_name) {
            return res.status(400).json({
                success: false,
                message: '供应商名称不能为空'
            });
        }
        
        // 检查是否已存在相同供应商名称和data_type的记录
        const existing = await VendorConfig.findOne({
            where: {
                supplier_name,
                data_type: data_type || 'purchase'
            }
        });
        
        if (existing) {
            return res.status(400).json({
                success: false,
                message: `该供应商的${data_type === 'purchase' ? '外购' : '外协'}记录已存在`
            });
        }
        
        // 创建供应商配置
        const config = await VendorConfig.create({
            supplier_name,
            data_type: data_type || 'purchase',
            source: source || 'IQC',
            enable_document_mgmt: enable_document_mgmt || false,
            enable_performance_mgmt: enable_performance_mgmt || false,
            status: 'Active'
        });
        
        res.json({
            success: true,
            message: '供应商配置创建成功',
            data: config
        });
    } catch (error) {
        console.error('创建供应商配置失败:', error);
        res.status(500).json({
            success: false,
            message: '创建供应商配置失败'
        });
    }
});
```

#### 4.2.3 更新供应商API
**文件**：`server/routes/vendors.js`

**修改内容**：
```javascript
// 更新供应商配置
router.put('/:id', authenticateToken, async (req, res) => {
    try {
        const { supplier_name, data_type, enable_document_mgmt, enable_performance_mgmt, status } = req.body;
        
        const config = await VendorConfig.findByPk(id);
        if (!config) {
            return res.status(404).json({
                success: false,
                message: '供应商配置不存在'
            });
        }
        
        // 检查是否与其他记录冲突（修改supplier_name或data_type时）
        if (supplier_name || data_type) {
            const newSupplierName = supplier_name || config.supplier_name;
            const newDataType = data_type || config.data_type;
            
            const conflict = await VendorConfig.findOne({
                where: {
                    supplier_name: newSupplierName,
                    data_type: newDataType,
                    id: { [require('sequelize').Op.ne]: id }
                }
            });
            
            if (conflict) {
                return res.status(400).json({
                    success: false,
                    message: `该供应商的${newDataType === 'purchase' ? '外购' : '外协'}记录已存在`
                });
            }
        }
        
        // 更新配置
        await config.update({
            supplier_name: supplier_name || config.supplier_name,
            data_type: data_type !== undefined ? data_type : config.data_type,
            enable_document_mgmt: enable_document_mgmt !== undefined ? enable_document_mgmt : config.enable_document_mgmt,
            enable_performance_mgmt: enable_performance_mgmt !== undefined ? enable_performance_mgmt : config.enable_performance_mgmt,
            status: status !== undefined ? status : config.status
        });
        
        res.json({
            success: true,
            message: '供应商配置更新成功',
            data: config
        });
    } catch (error) {
        console.error('更新供应商配置失败:', error);
        res.status(500).json({
            success: false,
            message: '更新供应商配置失败'
        });
    }
});
```

---

## 五、前端修改

### 5.1 修改创建供应商对话框

**文件**：`public/index.html`

**修改内容**：
```html
<!-- 创建供应商对话框 -->
<div id="addVendorModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>添加供应商</h3>
            <button class="btn-icon" id="closeAddVendorModalBtn">
                <i class="ph ph-x"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="addVendorForm">
                <div class="form-group">
                    <label>供应商名称 *</label>
                    <input type="text" id="addVendorName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>数据类型 *</label>
                    <select id="addVendorDataType" class="form-control" required>
                        <option value="purchase">外购</option>
                        <option value="external">外协</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>数据来源</label>
                    <select id="addVendorSource" class="form-control">
                        <option value="IQC">IQC</option>
                        <option value="MANUAL">手动添加</option>
                        <option value="IMPORT">导入</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="addVendorEnableDocument">
                        启用资料管理
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="addVendorEnablePerformance">
                        启用绩效评价
                    </label>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelAddVendorBtn">取消</button>
                    <button type="submit" class="btn btn-primary">添加</button>
                </div>
            </form>
        </div>
    </div>
</div>
```

### 5.2 修改编辑供应商对话框

**文件**：`public/index.html`

**修改内容**：
```html
<!-- 编辑供应商对话框 -->
<div id="editVendorModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>编辑供应商</h3>
            <button class="btn-icon" id="closeEditVendorModalBtn">
                <i class="ph ph-x"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="editVendorForm">
                <input type="hidden" id="editVendorId">
                <div class="form-group">
                    <label>供应商名称 *</label>
                    <input type="text" id="editVendorName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>数据类型 *</label>
                    <select id="editVendorDataType" class="form-control" required>
                        <option value="purchase">外购</option>
                        <option value="external">外协</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>数据来源</label>
                    <select id="editVendorSource" class="form-control">
                        <option value="IQC">IQC</option>
                        <option value="MANUAL">手动添加</option>
                        <option value="IMPORT">导入</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="editVendorEnableDocument">
                        启用资料管理
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="editVendorEnablePerformance">
                        启用绩效评价
                    </label>
                </div>
                <div class="form-group">
                    <label>状态</label>
                    <select id="editVendorStatus" class="form-control">
                        <option value="Active">启用</option>
                        <option value="Inactive">禁用</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelEditVendorBtn">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>
</div>
```

### 5.3 修改供应商列表显示

**文件**：`public/index.html`

**修改内容**：
```html
<!-- 供应商列表 -->
<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>供应商名称</th>
                <th>数据类型</th>
                <th>数据来源</th>
                <th>资料管理</th>
                <th>绩效评价</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="vendorTableBody">
            <!-- 数据将动态加载 -->
        </tbody>
    </table>
</div>
```

### 5.4 修改JavaScript逻辑

**文件**：`public/js/modules/vendor-config.js`

**修改内容**：
```javascript
// 渲染供应商列表
renderVendorList(vendors) {
    const tbody = document.getElementById('vendorTableBody');
    tbody.innerHTML = '';
    
    // 按供应商名称分组
    const vendorGroups = {};
    vendors.forEach(v => {
        if (!vendorGroups[v.supplier_name]) {
            vendorGroups[v.supplier_name] = [];
        }
        vendorGroups[v.supplier_name].push(v);
    });
    
    // 渲染分组后的列表
    for (const [supplierName, records] of Object.entries(vendorGroups)) {
        if (records.length === 1) {
            // 只有一条记录，直接显示
            this.renderVendorRow(records[0], false);
        } else {
            // 多条记录，显示分组
            this.renderVendorGroup(supplierName, records);
        }
    }
}

// 渲染单个供应商行
renderVendorRow(vendor, isGrouped) {
    const tbody = document.getElementById('vendorTableBody');
    const row = document.createElement('tr');
    
    const dataTypeText = vendor.data_type === 'purchase' ? '外购' : '外协';
    const dataTypeClass = vendor.data_type === 'purchase' ? 'badge-purchase' : 'badge-external';
    
    row.innerHTML = `
        <td>${vendor.supplier_name}${isGrouped ? ` <span class="badge ${dataTypeClass}">${dataTypeText}</span>` : ''}</td>
        <td>${isGrouped ? '-' : `<span class="badge ${dataTypeClass}">${dataTypeText}</span>`}</td>
        <td>${vendor.source}</td>
        <td>${vendor.enable_document_mgmt ? '<span class="status-badge success">已启用</span>' : '<span class="status-badge">未启用</span>'}</td>
        <td>${vendor.enable_performance_mgmt ? '<span class="status-badge success">已启用</span>' : '<span class="status-badge">未启用</span>'}</td>
        <td><span class="status-badge ${vendor.status === 'Active' ? 'success' : 'warning'}">${vendor.status === 'Active' ? '启用' : '禁用'}</span></td>
        <td>
            <button class="btn btn-sm btn-secondary" onclick="window.App.Modules.VendorConfig.editVendor(${vendor.id})">编辑</button>
            <button class="btn btn-sm btn-danger" onclick="window.App.Modules.VendorConfig.deleteVendor(${vendor.id})">删除</button>
        </td>
    `;
    
    tbody.appendChild(row);
}

// 渲染供应商分组
renderVendorGroup(supplierName, records) {
    const tbody = document.getElementById('vendorTableBody');
    
    // 添加分组标题行
    const groupRow = document.createElement('tr');
    groupRow.className = 'vendor-group-row';
    groupRow.innerHTML = `
        <td colspan="7">
            <div class="vendor-group-header">
                <strong>${supplierName}</strong>
                <span class="vendor-group-count">(${records.length} 条记录)</span>
            </div>
        </td>
    `;
    tbody.appendChild(groupRow);
    
    // 添加每条记录
    records.forEach(record => {
        this.renderVendorRow(record, true);
    });
}

// 添加供应商
async addVendor(e) {
    e.preventDefault();
    
    const formData = {
        supplier_name: document.getElementById('addVendorName').value,
        data_type: document.getElementById('addVendorDataType').value,
        source: document.getElementById('addVendorSource').value,
        enable_document_mgmt: document.getElementById('addVendorEnableDocument').checked,
        enable_performance_mgmt: document.getElementById('addVendorEnablePerformance').checked
    };
    
    try {
        const response = await fetch('/api/vendors', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('authToken')}`
            },
            body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('供应商添加成功！');
            this.closeAddVendorModal();
            this.loadVendors();
        } else {
            alert('添加失败：' + result.message);
        }
    } catch (error) {
        console.error('添加供应商失败:', error);
        alert('添加供应商失败');
    }
}
```

### 5.5 添加CSS样式

**文件**：`public/css/modules/vendor-config-components.css`

**新增样式**：
```css
/* 数据类型徽章 */
.badge-purchase {
    display: inline-block;
    padding: 2px 8px;
    background: var(--info-light);
    color: var(--info);
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

.badge-external {
    display: inline-block;
    padding: 2px 8px;
    background: var(--warning-light);
    color: var(--warning);
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

/* 供应商分组行 */
.vendor-group-row {
    background: var(--gray-100);
}

.vendor-group-header {
    display: flex;
    align-items: center;
    gap: var(--border-radius-sm);
}

.vendor-group-count {
    color: var(--gray-500);
    font-size: 12px;
}
```

---

## 六、显示逻辑优化

### 6.1 智能显示逻辑

**核心原则**：
- 如果供应商只有一条记录：不显示分类标识
- 如果供应商有多条记录：显示分类标识

**实现代码**：
```javascript
// 获取显示名称
function getDisplayName(vendor, hasMultipleRecords) {
    if (hasMultipleRecords) {
        // 有多条记录，显示分类标识
        const dataTypeText = vendor.data_type === 'purchase' ? '外购' : '外协';
        return `${vendor.supplier_name}（${dataTypeText}）`;
    } else {
        // 只有一条记录，不显示分类标识
        return vendor.supplier_name;
    }
}

// 检查供应商是否有多条记录
async function checkIfVendorHasMultipleRecords(supplierName) {
    const count = await VendorConfig.count({
        where: { supplier_name }
    });
    return count > 1;
}
```

### 6.2 显示效果示例

**场景1：只有外购的供应商**
```
┌─────────────────────────────────────────────────┐
│ 旭航              外购   IQC   已启用  已启用  [操作] │
└─────────────────────────────────────────────────┘
```

**场景2：只有外协的供应商**
```
┌─────────────────────────────────────────────────┐
│ 森永              外协   IQC   已启用  已启用  [操作] │
└─────────────────────────────────────────────────┘
```

**场景3：既有外购又有外协的供应商**
```
┌─────────────────────────────────────────────────┐
│ 常兴                          (2 条记录)          │
├─────────────────────────────────────────────────┤
│ 常兴（外购）      外购   IQC   已启用  已启用  [操作] │
│ 常兴（外协）      外协   IQC   已启用  已启用  [操作] │
└─────────────────────────────────────────────────┘
```

---

## 七、实施步骤

### 阶段1：数据库迁移
- [ ] 创建迁移脚本
- [ ] 执行迁移脚本
- [ ] 验证迁移结果
- [ ] 备份现有数据

### 阶段2：后端修改
- [ ] 修改VendorConfig模型
- [ ] 修改创建供应商API
- [ ] 修改更新供应商API
- [ ] 修改查询供应商API
- [ ] 添加冲突检测逻辑

### 阶段3：前端修改
- [ ] 修改创建供应商对话框
- [ ] 修改编辑供应商对话框
- [ ] 修改供应商列表显示
- [ ] 添加data_type选择器
- [ ] 实现分组显示逻辑
- [ ] 添加CSS样式

### 阶段4：测试
- [ ] 测试创建外购供应商
- [ ] 测试创建外协供应商
- [ ] 测试创建同一供应商的两种类型
- [ ] 测试编辑供应商
- [ ] 测试删除供应商
- [ ] 测试冲突检测
- [ ] 测试显示逻辑

### 阶段5：数据迁移
- [ ] 为现有供应商设置data_type
- [ ] 验证数据迁移结果
- [ ] 测试现有数据

---

## 八、风险评估

### 8.1 技术风险

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 数据迁移失败 | 中 | 高 | 备份数据，提供回滚脚本 |
| 索引冲突 | 低 | 中 | 先删除旧索引，再创建新索引 |
| API兼容性问题 | 中 | 中 | 保留向后兼容性，默认值处理 |
| 显示逻辑错误 | 中 | 低 | 充分测试，提供配置选项 |

### 8.2 业务风险

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 用户不理解外购外协区分 | 中 | 低 | 提供清晰的UI提示和文档 |
| 现有数据需要手动分类 | 高 | 中 | 提供批量数据迁移工具 |
| 显示不够美观 | 低 | 低 | 智能显示逻辑，单一类型不显示标识 |

---

## 九、预计时间

| 阶段 | 任务 | 预计时间 |
|------|------|----------|
| 阶段1 | 数据库迁移 | 30分钟 |
| 阶段2 | 后端修改 | 1小时 |
| 阶段3 | 前端修改 | 1.5小时 |
| 阶段4 | 测试 | 1小时 |
| 阶段5 | 数据迁移 | 30分钟 |
| **总计** | | **4小时** |

---

## 十、验收标准

### 10.1 功能验收
- [ ] 可以创建外购供应商
- [ ] 可以创建外协供应商
- [ ] 可以为同一供应商创建外购和外协两条记录
- [ ] 创建时检测冲突（相同供应商名称和data_type）
- [ ] 编辑时检测冲突
- [ ] 删除时正确处理
- [ ] 查询时正确返回数据

### 10.2 显示验收
- [ ] 只有一条记录的供应商不显示分类标识
- [ ] 有多条记录的供应商显示分类标识
- [ ] 列表显示清晰美观
- [ ] 分组显示正确

### 10.3 数据验收
- [ ] 现有数据正确迁移
- [ ] data_type字段正确设置
- [ ] 唯一索引正确工作
- [ ] 数据完整性保持

---

## 十一、后续影响

### 11.1 受影响模块
1. **IQC质量分析**
   - 需要根据data_type过滤数据
   - 显示时可能需要显示分类标识

2. **供应商月度绩效评价**
   - 需要根据data_type提取质量数据
   - 显示时需要智能判断分类标识
   - 评价时需要区分外购和外协

3. **供应商资料管理**
   - 需要根据data_type管理资料
   - 显示时需要智能判断分类标识

### 11.2 后续优化
- [ ] 提供批量分类工具
- [ ] 提供配置选项（是否显示分类标识）
- [ ] 优化分组显示效果
- [ ] 添加数据类型统计

---

## 十二、总结

### 核心原则
1. **数据准确性优先**：确保与IQC数据结构对应
2. **用户体验优化**：智能显示逻辑，单一类型不显示标识
3. **向后兼容**：保留现有功能，不破坏已有数据
4. **可扩展性**：支持未来可能的数据类型扩展

### 预期效果
- ✅ 数据结构清晰，外购和外协区分明确
- ✅ 显示美观，单一类型不显示多余信息
- ✅ 数据准确，与IQC数据对应
- ✅ 适应所有场景，支持单一和混合类型供应商