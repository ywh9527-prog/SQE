# 📊 供应商月度绩效评价系统 - 完整产品策划

**策划人**: Antigravity AI (Product Manager & Quality Engineer)  
**日期**: 2025-12-01  
**版本**: v2.0（含评分规则配置系统）  
**项目**: IFLOW SQE Data Analysis Assistant

---

## 📑 目录

1. [产品定位](#产品定位)
2. [产品架构设计](#产品架构设计)
3. [核心功能设计](#核心功能设计)
   - 双卡片数据源管理
   - 多维度自动评分系统
   - **评分规则配置系统** ⭐ 新增
   - 供应商排名与等级划分
   - 详细评分报告
   - 月度对比与趋势分析
4. [技术实现方案](#技术实现方案)
5. [UI/UX设计规范](#uiux设计规范)
6. [实施计划](#实施计划)
7. [验收标准](#验收标准)

---

## 🎯 产品定位

### 核心价值
> "让供应商管理从定性走向定量，从经验判断走向数据驱动"

**一句话描述**:  
基于IQC来料检验数据动态生成的供应商月度绩效评价系统，支持外购/外协分类管理，**支持灵活配置评分规则**，实现供应商优劣一目了然。

**核心原则**: ⭐ 数据驱动
> "有数据才有评价，无数据不评价"  
> 绩效评价完全基于IQC来料检验数据，系统自动检测数据覆盖的月份范围，仅对有来料记录的月份生成评价。

**数据与评价的关系**:
```
IQC来料数据覆盖: 2024-01 ~ 2024-11
  ↓
绩效评价可生成: 2024-01 ~ 2024-11
  ↓
月份选择器显示: 2024-01 ~ 2024-11（共11个月份）

示例:
- 2024-11月有来料数据 → ✅ 可生成11月绩效评价
- 2024-12月无来料数据 → ❌ 不显示12月选项，无法生成评价
- 某供应商11月无来料 → ⚠️ 该供应商11月无评分，不参与排名
```

**一句话描述（原）**:  
基于多维度数据自动评分的供应商月度绩效评价系统，支持外购/外协分类管理，**支持灵活配置评分规则**，实现供应商优劣一目了然。

### 目标用户
- **主要用户**: SQE工程师（供应商质量工程师）
- **次要用户**: 采购经理、质量经理、供应链总监
- **使用场景**: 
  - 月度供应商绩效评审会议
  - 供应商优化决策（淘汰/扶持）
  - 供应商年度评级
  - **评分标准调整与优化** ⭐

---

## 📐 产品架构设计

### 系统架构图

```
供应商月度绩效评价系统
├── 数据驱动层 ⭐ 核心
│   ├── IQC数据月份检测
│   ├── 可评价月份计算
│   ├── 供应商来料记录检查
│   └── 动态月份列表生成
│
├── 数据源层
│   ├── IQC来料检验数据（外购/外协）
│   ├── 供应商资料数据（证书、协议）
│   └── 交付数据（未来扩展）
│
├── 配置层 ⭐ 新增
│   ├── 评分方案管理
│   ├── 维度权重配置
│   ├── 指标权重配置
│   └── 计算规则配置
│
├── 评分引擎层
│   ├── 质量维度评分（权重可配置）
│   ├── 交付维度评分（权重可配置）
│   └── 服务维度评分（权重可配置）
│
├── 数据处理层
│   ├── 月度数据聚合
│   ├── 自动评分计算
│   ├── 排名生成
│   └── 趋势分析
│
└── 展示层
    ├── 外购供应商绩效卡片
    ├── 外协供应商绩效卡片
    ├── 供应商排名榜
    ├── 绩效趋势图
    ├── 详细评分报告
    └── 评分规则配置界面 ⭐ 新增
```

---

## 🎨 核心功能设计

### 功能0: 数据驱动的绩效评价机制 ⭐ 核心业务逻辑

#### 0.1 设计理念

> "绩效评价必须基于真实的来料数据，没有数据就没有评价的意义"

**核心原则**:
1. **数据为王**: 绩效评价100%基于IQC来料检验数据
2. **动态生成**: 根据实际数据覆盖范围动态生成可评价月份
3. **按需评价**: 只对有来料记录的供应商进行评价
4. **透明可追溯**: 每个评分都能追溯到具体的来料批次

---

#### 0.2 数据与评价的映射关系

##### 场景1: 系统初始化时

```
步骤1: 扫描IQC数据表
  SELECT DISTINCT 
    strftime('%Y-%m', 检验日期) as month,
    供应商类型
  FROM iqc_data
  ORDER BY month DESC;

步骤2: 生成可评价月份列表
  外购数据: 2024-01, 2024-02, ..., 2024-11 (11个月)
  外协数据: 2024-01, 2024-02, ..., 2024-11 (11个月)

步骤3: 填充月份选择器
  <select id="monthSelector">
    <option value="2024-11">2024年11月</option>
    <option value="2024-10">2024年10月</option>
    ...
    <option value="2024-01">2024年1月</option>
  </select>
```

##### 场景2: 用户上传新的来料数据

```
假设: 用户上传了2024年12月的来料数据

步骤1: 数据入库后，触发月份列表更新
  检测到新月份: 2024-12

步骤2: 刷新月份选择器
  新增选项: <option value="2024-12">2024年12月</option>

步骤3: 自动切换到最新月份
  默认选中: 2024-12

步骤4: 提示用户
  Toast: "检测到2024年12月的新数据，是否立即生成绩效评价？"
```

##### 场景3: 某月无来料数据

```
假设: 2024年8月所有供应商都没有来料记录

结果:
  - 月份选择器中不显示"2024年8月"
  - 用户无法选择8月进行评价
  - 趋势图中8月显示为"无数据"
```

---

#### 0.3 供应商级别的数据检查

##### 规则: 某供应商某月无来料 → 该月无评分

```javascript
// 示例数据
const suppliers = [
  { id: 1, name: '深圳XX电子', hasData: true },   // 11月有来料
  { id: 2, name: '东莞YY科技', hasData: true },   // 11月有来料
  { id: 3, name: '广州ZZ实业', hasData: false },  // 11月无来料
];

// 生成评价时
for (const supplier of suppliers) {
  if (!supplier.hasData) {
    // 跳过无数据的供应商
    console.log(`${supplier.name} 在2024-11月无来料记录，跳过评价`);
    continue;
  }
  
  // 生成评价
  generatePerformanceEvaluation(supplier.id, '2024-11');
}

// 结果
排名表:
  1. 深圳XX电子 - 95.2分
  2. 东莞YY科技 - 92.8分
  (广州ZZ实业不在排名中)

详细列表:
  深圳XX电子 - 95.2分 ✅
  东莞YY科技 - 92.8分 ✅
  广州ZZ实业 - 无评分 ⚠️ (本月无来料记录)
```

---

#### 0.4 UI交互设计

##### 月份选择器（动态生成）

```html
<div class="month-selector-container">
  <label>评价月份:</label>
  <select id="monthSelector" class="month-select">
    <!-- 动态生成，仅显示有数据的月份 -->
    <option value="2024-11" selected>2024年11月 (最新)</option>
    <option value="2024-10">2024年10月</option>
    <option value="2024-09">2024年9月</option>
    <!-- ... -->
    <option value="2024-01">2024年1月</option>
  </select>
  <span class="data-range-hint">
    📅 数据范围: 2024-01 ~ 2024-11 (共11个月)
  </span>
</div>
```

##### 无数据提示

```
┌─────────────────────────────────────────────────────┐
│  📊 供应商月度绩效评价                               │
├─────────────────────────────────────────────────────┤
│  📅 评价月份: [2024-12 ▼]                           │
│                                                      │
│  ⚠️ 暂无数据                                         │
│  ┌────────────────────────────────────────────────┐ │
│  │                                                 │ │
│  │  📭 2024年12月暂无来料检验数据                  │ │
│  │                                                 │ │
│  │  请先上传IQC来料检验数据，系统将自动生成绩效评价│ │
│  │                                                 │ │
│  │  [上传来料数据]                                 │ │
│  │                                                 │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

##### 部分供应商无数据提示

```
🏆 外购供应商月度绩效排名（2024年11月）
┌──────┬────────────────┬────────┬────────┬──────────┐
│ 排名 │ 供应商名称      │ 综合分 │ 等级   │ 趋势     │
├──────┼────────────────┼────────┼────────┼──────────┤
│  1   │ 深圳XX电子     │ 95.2分 │ S级 🟢 │ ↑ +2.3  │
│  2   │ 东莞YY科技     │ 92.8分 │ S级 🟢 │ ↑ +1.5  │
│  -   │ 广州ZZ实业     │ 无评分 │ -      │ 📭 无来料│
│  3   │ 惠州AA制造     │ 85.3分 │ A级 🔵 │ ↓ -1.2  │
└──────┴────────────────┴────────┴────────┴──────────┘

💡 提示: 本月共45家供应商，其中42家有来料记录并参与评价，
        3家供应商本月无来料记录，不参与排名。
```

---

#### 0.5 技术实现方案

##### 后端API: 获取可评价月份列表 ⭐ 新增

```javascript
GET /api/performance/available-months
Query:
  supplierType: "purchase" | "external"

Response:
{
  "success": true,
  "data": {
    "availableMonths": [
      {
        "month": "2024-11",
        "label": "2024年11月",
        "supplierCount": 45,
        "isLatest": true
      },
      {
        "month": "2024-10",
        "label": "2024年10月",
        "supplierCount": 43,
        "isLatest": false
      },
      // ...
    ],
    "dataRange": {
      "start": "2024-01",
      "end": "2024-11",
      "totalMonths": 11
    }
  }
}
```

**后端实现逻辑**:
```javascript
async function getAvailableMonths(supplierType) {
  // 1. 查询该类型供应商的所有来料月份
  const months = await db.query(`
    SELECT DISTINCT 
      strftime('%Y-%m', inspection_date) as month,
      COUNT(DISTINCT supplier_id) as supplier_count
    FROM iqc_data
    WHERE supplier_type = ?
    GROUP BY month
    ORDER BY month DESC
  `, [supplierType]);
  
  // 2. 格式化返回数据
  const availableMonths = months.map((row, index) => ({
    month: row.month,
    label: formatMonthLabel(row.month),
    supplierCount: row.supplier_count,
    isLatest: index === 0
  }));
  
  // 3. 计算数据范围
  const dataRange = {
    start: months[months.length - 1].month,
    end: months[0].month,
    totalMonths: months.length
  };
  
  return { availableMonths, dataRange };
}
```

##### 后端API: 检查供应商是否有数据 ⭐ 新增

```javascript
GET /api/performance/check-supplier-data
Query:
  supplierId: 123
  month: "2024-11"

Response:
{
  "success": true,
  "data": {
    "hasData": true,
    "batchCount": 15,
    "dateRange": {
      "start": "2024-11-01",
      "end": "2024-11-28"
    }
  }
}

// 如果无数据
Response:
{
  "success": true,
  "data": {
    "hasData": false,
    "message": "该供应商在2024年11月无来料记录"
  }
}
```

##### 前端逻辑: 动态加载月份选择器

```javascript
class PerformanceModule {
  async init() {
    // 1. 加载可评价月份
    await this.loadAvailableMonths();
    
    // 2. 默认选中最新月份
    this.selectLatestMonth();
    
    // 3. 加载该月份的绩效数据
    await this.loadPerformanceData();
  }
  
  async loadAvailableMonths() {
    const response = await API.getAvailableMonths(this.currentType);
    const { availableMonths, dataRange } = response.data;
    
    // 填充月份选择器
    const selector = document.getElementById('monthSelector');
    selector.innerHTML = availableMonths.map(m => `
      <option value="${m.month}" ${m.isLatest ? 'selected' : ''}>
        ${m.label} ${m.isLatest ? '(最新)' : ''}
      </option>
    `).join('');
    
    // 显示数据范围提示
    document.querySelector('.data-range-hint').textContent = 
      `📅 数据范围: ${dataRange.start} ~ ${dataRange.end} (共${dataRange.totalMonths}个月)`;
  }
  
  async loadPerformanceData() {
    const month = this.getSelectedMonth();
    
    // 检查是否有数据
    const hasData = await this.checkMonthData(month);
    
    if (!hasData) {
      this.showNoDataMessage(month);
      return;
    }
    
    // 生成或加载绩效评价
    await this.generateOrLoadPerformance(month);
  }
  
  async checkMonthData(month) {
    const response = await API.checkMonthData(month, this.currentType);
    return response.data.hasData;
  }
  
  showNoDataMessage(month) {
    const container = document.querySelector('.performance-container');
    container.innerHTML = `
      <div class="no-data-message">
        <div class="icon">📭</div>
        <h3>${month}暂无来料检验数据</h3>
        <p>请先上传IQC来料检验数据，系统将自动生成绩效评价</p>
        <button class="btn-primary" onclick="goToIQCModule()">
          前往上传来料数据
        </button>
      </div>
    `;
  }
}
```

---

#### 0.6 数据更新触发机制

##### 触发场景1: 用户上传新的IQC数据

```javascript
// 在IQC模块上传数据成功后
async function onIQCDataUploaded(fileId, month, supplierType) {
  // 1. 检查是否是新月份
  const isNewMonth = await checkIfNewMonth(month, supplierType);
  
  if (isNewMonth) {
    // 2. 刷新可评价月份列表
    await refreshAvailableMonths(supplierType);
    
    // 3. 提示用户
    showToast(
      `检测到${month}的新数据，是否立即生成绩效评价？`,
      'info',
      {
        actions: [
          { label: '立即生成', onClick: () => generatePerformance(month) },
          { label: '稍后', onClick: () => {} }
        ]
      }
    );
  } else {
    // 4. 如果该月份已有评价，提示是否重新生成
    const hasEvaluation = await checkIfHasEvaluation(month, supplierType);
    
    if (hasEvaluation) {
      showToast(
        `${month}已有绩效评价，是否重新生成？`,
        'warning',
        {
          actions: [
            { label: '重新生成', onClick: () => regeneratePerformance(month) },
            { label: '保留现有', onClick: () => {} }
          ]
        }
      );
    }
  }
}
```

##### 触发场景2: 用户删除IQC数据

```javascript
// 在IQC模块删除数据后
async function onIQCDataDeleted(month, supplierType) {
  // 1. 检查该月份是否还有数据
  const hasData = await checkMonthData(month, supplierType);
  
  if (!hasData) {
    // 2. 删除该月份的绩效评价
    await deletePerformanceEvaluation(month, supplierType);
    
    // 3. 刷新可评价月份列表
    await refreshAvailableMonths(supplierType);
    
    // 4. 提示用户
    showToast(
      `${month}已无来料数据，该月份的绩效评价已删除`,
      'info'
    );
    
    // 5. 如果当前正在查看该月份，切换到最新月份
    if (getCurrentMonth() === month) {
      switchToLatestMonth();
    }
  }
}
```

---

#### 0.7 边界情况处理

##### 情况1: 系统初始化时无任何IQC数据

```
UI显示:
┌─────────────────────────────────────────────────────┐
│  📊 供应商月度绩效评价                               │
├─────────────────────────────────────────────────────┤
│  ⚠️ 暂无数据                                         │
│  ┌────────────────────────────────────────────────┐ │
│  │                                                 │ │
│  │  📭 系统中暂无IQC来料检验数据                   │ │
│  │                                                 │ │
│  │  请先前往"IQC质量分析"模块上传来料数据，        │ │
│  │  系统将自动生成供应商绩效评价。                 │ │
│  │                                                 │ │
│  │  [前往上传数据]                                 │ │
│  │                                                 │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

##### 情况2: 某月只有部分供应商有数据

```javascript
// 示例: 2024-11月
总供应商数: 50家
有来料数据: 45家
无来料数据: 5家

// 处理逻辑
1. 为45家有数据的供应商生成评价
2. 5家无数据的供应商标记为"本月无来料"
3. 排名表中显示所有50家，但无数据的不参与排名
4. 统计信息中说明: "本月共50家供应商，45家参与评价"
```

##### 情况3: 跨年度数据查看

```javascript
// 月份选择器分组显示
<select id="monthSelector">
  <optgroup label="2024年">
    <option value="2024-12">12月</option>
    <option value="2024-11">11月</option>
    ...
    <option value="2024-01">1月</option>
  </optgroup>
  <optgroup label="2023年">
    <option value="2023-12">12月</option>
    ...
  </optgroup>
</select>
```

---

## 🎨 核心功能设计

### 功能1: 双卡片数据源管理

#### UI布局
```
┌─────────────────────────────────────────────────────┐
│  📊 供应商月度绩效评价                 [⚙️ 评分配置]│
├─────────────────────────────────────────────────────┤
│  ┌──────────────────────┐  ┌──────────────────────┐│
│  │ 📦 外购供应商绩效    │  │ 🏭 外协供应商绩效    ││
│  ├──────────────────────┤  ├──────────────────────┤│
│  │ 📅 评价月份: 2024-11 │  │ 📅 评价月份: 2024-11 ││
│  │ 📊 供应商数量: 45家  │  │ 📊 供应商数量: 23家  ││
│  │ ⭐ 平均得分: 87.5分  │  │ ⭐ 平均得分: 82.3分  ││
│  │ 🏆 优秀供应商: 12家  │  │ 🏆 优秀供应商: 6家   ││
│  │ ⚠️ 待改善: 3家       │  │ ⚠️ 待改善: 5家       ││
│  ├──────────────────────┤  ├──────────────────────┤│
│  │ [查看详细排名]       │  │ [查看详细排名]       ││
│  └──────────────────────┘  └──────────────────────┘│
│  📅 月份选择: [2024-11 ▼]  [生成评价报告]          │
└─────────────────────────────────────────────────────┘
```

---

### 功能2: 多维度自动评分系统

#### 默认评分维度（可通过配置系统调整）

##### 维度1: 质量维度（默认权重50%）

| 指标 | 默认权重 | 数据来源 | 满分标准 |
|------|---------|---------|---------|
| 批次合格率 | 30% | IQC数据 | ≥98% |
| 来料不良率 | 15% | IQC数据 | ≤2% |
| 批退率 | 10% | IQC数据 | 0% |
| 特采率 | 10% | IQC数据 | ≤5% |
| 重复性问题 | 10% | IQC数据 | 0次 |
| 质量改善响应 | 15% | 人工评价 | 3天内 |

##### 维度2: 交付维度（默认权重30%）

| 指标 | 默认权重 | 数据来源 | 满分标准 |
|------|---------|---------|---------|
| 交付及时率 | 15% | 交付数据 | 100% |
| 交付准确率 | 10% | 交付数据 | 100% |
| 紧急需求响应 | 5% | 人工评价 | 24小时内 |

##### 维度3: 服务维度（默认权重20%）

| 指标 | 默认权重 | 数据来源 | 满分标准 |
|------|---------|---------|---------|
| 资料完整性 | 8% | 供应商资料 | 100% |
| 资料有效性 | 7% | 供应商资料 | 100% |
| 沟通配合度 | 5% | 人工评价 | 优秀 |

---

### 功能3: 评分规则配置系统 ⭐ 核心新增功能

#### 3.1 设计理念

> "不同企业、不同阶段、不同供应商类型，评价标准应该灵活可调"

**为什么需要配置系统？**

```
场景1: 不同企业的评价重点不同
  电子制造: 质量60% | 交付30% | 服务10%
  快消品: 质量40% | 交付50% | 服务10%
  高端装备: 质量50% | 交付20% | 服务30%

场景2: 不同供应商类型的标准不同
  外购（标准件）: 批次合格率 ≥98% → 满分
  外协（定制件）: 批次合格率 ≥95% → 满分

场景3: 评价标准逐步提升
  Q1: 合格率 ≥95% → 满分
  Q2: 合格率 ≥96% → 满分
  Q3: 合格率 ≥97% → 满分
  Q4: 合格率 ≥98% → 满分
```

---

#### 3.2 配置系统架构

```
三层配置结构:

Layer 1: 维度配置
  ├─ 质量维度（权重可调: 0-100%）
  ├─ 交付维度（权重可调: 0-100%）
  ├─ 服务维度（权重可调: 0-100%）
  └─ 自定义维度（可新增）

Layer 2: 指标配置
  ├─ 每个维度下的具体指标
  ├─ 指标权重可调
  └─ 指标可启用/禁用

Layer 3: 计算规则配置
  ├─ 满分标准可调
  ├─ 计算公式可选（线性/阶梯/曲线/自定义）
  └─ 评分曲线可视化
```

---

#### 3.3 配置界面设计

##### 主配置页面

```
┌─────────────────────────────────────────────────────┐
│  ⚙️ 绩效评价规则配置                                 │
├─────────────────────────────────────────────────────┤
│  📋 配置方案管理                                     │
│  当前方案: [默认方案 ▼]                              │
│  [新建方案] [复制方案] [删除方案] [导入/导出]       │
├─────────────────────────────────────────────────────┤
│  📊 维度权重配置                                     │
│                                                      │
│  ✅ 质量维度                                         │
│     权重: [████████████░░░░░░░░] 50%               │
│     [配置指标 →]                                     │
│                                                      │
│  ✅ 交付维度                                         │
│     权重: [███████░░░░░░░░░░░░░] 30%               │
│     [配置指标 →]                                     │
│                                                      │
│  ✅ 服务维度                                         │
│     权重: [████░░░░░░░░░░░░░░░░] 20%               │
│     [配置指标 →]                                     │
│                                                      │
│  ⬜ 创新维度（自定义）                               │
│     权重: [░░░░░░░░░░░░░░░░░░░░] 0%                │
│     [启用] [配置指标 →]                              │
│                                                      │
│  总计: 100% ✅                                       │
├─────────────────────────────────────────────────────┤
│  [保存配置] [重置为默认] [预览评分效果]             │
└─────────────────────────────────────────────────────┘
```

##### 指标详细配置页面

```
┌─────────────────────────────────────────────────────┐
│  ⚙️ 质量维度 - 指标配置                              │
├─────────────────────────────────────────────────────┤
│  维度权重: 50%  |  指标总数: 6个（5个启用）         │
│                                                      │
│  ✅ 批次合格率                                       │
│     权重: [████████████████████░░] 30%             │
│     满分标准: [≥ 98] %                              │
│     计算方式: [线性计分 ▼]                          │
│     数据来源: [IQC数据-自动 ▼]                      │
│     [详细配置 →]                                     │
│  ────────────────────────────────────────────────   │
│  ✅ 来料不良率                                       │
│     权重: [███████████░░░░░░░░░] 15%               │
│     满分标准: [≤ 2] %                               │
│     [详细配置 →]                                     │
│  ────────────────────────────────────────────────   │
│  ✅ 批退率                                           │
│     权重: [██████░░░░░░░░░░░░░░] 10%               │
│     满分标准: [= 0] %                               │
│     计算方式: [阶梯计分 ▼]                          │
│     [详细配置 →]                                     │
│  ────────────────────────────────────────────────   │
│  ⬜ 质量改善响应（已禁用）                           │
│     权重: [███████████░░░░░░░░░] 15%               │
│     [启用]                                           │
│                                                      │
│  [+ 添加自定义指标]                                 │
│  [保存配置] [返回]                                   │
└─────────────────────────────────────────────────────┘
```

---

#### 3.4 四种计算方式

##### 方式1: 线性计分（最常用）

**适用场景**: 批次合格率、来料不良率等连续型指标

**配置示例**:
```
批次合格率:
  满分标准: ≥98% → 30分
  及格标准: ≥90% → 18分
  零分标准: <80% → 0分

实际值: 95.5%
计算: 18 + (95.5 - 90) / (98 - 90) × 12 = 24.75分
```

**评分曲线**:
```
30分 ┤                          ●●●●●●●●
     │                      ●●●●
20分 ┤                  ●●●●
     │              ●●●●
10分 ┤          ●●●●
     │      ●●●●
 0分 ┤●●●●●●
     └──────┬──────┬──────┬──────┬──────
         80%    90%    95%    98%   100%
```

---

##### 方式2: 阶梯计分

**适用场景**: 批退率、重复性问题等离散型指标

**配置示例**:
```
重复性问题:
  0次 → 10分（满分）
  1次 → 7分
  2次 → 4分
  3次 → 2分
  ≥4次 → 0分

实际值: 1次
得分: 7分
```

---

##### 方式3: 曲线计分

**适用场景**: 需要非线性评分的指标

**曲线类型**:
- **指数曲线**: 前期增长慢，后期增长快（严格要求高分段）
- **对数曲线**: 前期增长快，后期增长慢（鼓励基础改善）
- **S型曲线**: 前后慢，中间快（平衡型）

---

##### 方式4: 自定义公式

**适用场景**: 特殊的评分需求

**示例**:
```javascript
公式: (value - threshold2) / (threshold1 - threshold2) * maxScore

变量:
  value: 实际值
  threshold1: 满分阈值
  threshold2: 零分阈值
  maxScore: 最大分数
```

---

#### 3.5 配置预览功能

```
┌─────────────────────────────────────────────────────┐
│  🧪 配置效果预览                                     │
├─────────────────────────────────────────────────────┤
│  选择供应商: [深圳XX电子 ▼]                         │
│  评价月份: [2024-11 ▼]                              │
│                                                      │
│  ┌──────────────────┐  ┌──────────────────┐        │
│  │ 当前方案         │  │ 新配置预览       │        │
│  ├──────────────────┤  ├──────────────────┤        │
│  │ 综合得分: 87.5分 │  │ 综合得分: 89.2分 │ ↑+1.7 │
│  │ 等级: A级        │  │ 等级: A级        │        │
│  ├──────────────────┤  ├──────────────────┤        │
│  │ 质量: 42.5分     │  │ 质量: 45.0分     │ ↑+2.5 │
│  │ 交付: 25.0分     │  │ 交付: 24.5分     │ ↓-0.5 │
│  │ 服务: 20.0分     │  │ 服务: 19.7分     │ ↓-0.3 │
│  └──────────────────┘  └──────────────────┘        │
│                                                      │
│  💡 变化说明:                                        │
│  - 质量维度权重从50%调整为60%，得分提升2.5分       │
│  - 交付维度权重从30%调整为25%，得分下降0.5分       │
│  - 服务维度权重从20%调整为15%，得分下降0.3分       │
│                                                      │
│  [应用新配置] [取消]                                 │
└─────────────────────────────────────────────────────┘
```

---

#### 3.6 配置方案模板

系统内置多套配置模板，用户可快速切换：

| 模板名称 | 质量 | 交付 | 服务 | 适用场景 |
|---------|------|------|------|---------|
| 默认方案 | 50% | 30% | 20% | 平衡型，适用于大部分企业 |
| 质量优先 | 70% | 20% | 10% | 高精度制造业 |
| 交付优先 | 40% | 50% | 10% | 快消品、电商行业 |
| 服务优先 | 40% | 30% | 30% | 高端装备、技术服务 |
| 严格方案 | 60% | 30% | 10% | 提升标准（满分阈值+2%） |

---

### 功能4: 供应商排名与等级划分

#### 等级划分标准

| 等级 | 分数范围 | 徽章 | 管理策略 |
|------|---------|------|---------|
| S级（优秀） | 90-100分 | 🟢 | 优先合作，增加订单 |
| A级（良好） | 80-89分 | 🔵 | 保持合作，稳定订单 |
| B级（合格） | 70-79分 | 🟡 | 辅导改善，减少订单 |
| C级（不合格） | 60-69分 | 🟠 | 限期整改，暂停新订单 |
| D级（淘汰） | <60分 | 🔴 | 终止合作 |

#### 排名展示UI

```
🏆 外购供应商月度绩效排名（2024年11月）
┌──────┬────────────────┬────────┬────────┬──────────┐
│ 排名 │ 供应商名称      │ 综合分 │ 等级   │ 趋势     │
├──────┼────────────────┼────────┼────────┼──────────┤
│  1   │ 深圳XX电子     │ 95.2分 │ S级 🟢 │ ↑ +2.3  │
│  2   │ 东莞YY科技     │ 92.8分 │ S级 🟢 │ ↑ +1.5  │
│  3   │ 广州ZZ实业     │ 88.5分 │ A级 🔵 │ → 0.0   │
│ ...  │ ...            │ ...    │ ...    │ ...      │
│ 45   │ 珠海EE组件     │ 58.3分 │ D级 🔴 │ ↓ -8.5  │
└──────┴────────────────┴────────┴────────┴──────────┘

[导出Excel] [生成改善建议] [发送评价邮件]
```

---

### 功能5: 详细评分报告

点击供应商名称，展开详细评分报告：

```
┌─────────────────────────────────────────────────────┐
│  供应商详细评分报告                                  │
│  供应商: 深圳XX电子有限公司                          │
│  评价月份: 2024年11月                                │
│  综合得分: 95.2分 (S级)                              │
├─────────────────────────────────────────────────────┤
│  📊 维度得分雷达图                                   │
│       质量(47.5/50)                                  │
│          /\                                          │
│         /  \                                         │
│  服务  /    \  交付                                  │
│  (19/20)    (28.7/30)                               │
│         \  /                                         │
│          \/                                          │
├─────────────────────────────────────────────────────┤
│  📋 详细指标                                         │
│  ✅ 质量维度 (47.5/50分)                            │
│     ├─ 批次合格率: 98.5% (30/30分) ✅               │
│     ├─ 来料不良率: 1.5% (14.8/15分) ✅              │
│     ├─ 批退率: 0% (10/10分) ✅                      │
│     ├─ 特采率: 3% (9.4/10分) ✅                     │
│     ├─ 重复性问题: 1次 (6.7/10分) ⚠️               │
│     └─ 质量改善响应: 优秀 (15/15分) ✅              │
├─────────────────────────────────────────────────────┤
│  📈 6个月趋势                                        │
│  89.5 → 91.2 → 92.8 → 93.5 → 94.0 → 95.2           │
├─────────────────────────────────────────────────────┤
│  💡 改善建议                                         │
│  ⚠️ 重复性问题: 尺寸偏差问题出现1次，建议加强过程控制│
└─────────────────────────────────────────────────────┘

[导出PDF] [发送给供应商] [创建改善任务]
```

---

## 🔧 技术实现方案

### 数据库设计

#### 表1: 评分方案表 (scoring_schemes) ⭐ 新增

```sql
CREATE TABLE scoring_schemes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100) NOT NULL,                -- 方案名称
    description TEXT,                          -- 方案描述
    is_default BOOLEAN DEFAULT false,          -- 是否为默认方案
    is_active BOOLEAN DEFAULT true,            -- 是否启用
    created_by INTEGER,                        -- 创建人
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 表2: 维度配置表 (dimension_configs) ⭐ 新增

```sql
CREATE TABLE dimension_configs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    scheme_id INTEGER NOT NULL,                -- 所属方案
    dimension_name VARCHAR(50) NOT NULL,       -- 维度名称
    dimension_label VARCHAR(100),              -- 显示名称
    weight DECIMAL(5,2) NOT NULL,              -- 权重（0-100）
    is_enabled BOOLEAN DEFAULT true,           -- 是否启用
    sort_order INTEGER DEFAULT 0,              -- 排序
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (scheme_id) REFERENCES scoring_schemes(id)
);
```

#### 表3: 指标配置表 (indicator_configs) ⭐ 新增

```sql
CREATE TABLE indicator_configs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    dimension_id INTEGER NOT NULL,             -- 所属维度
    indicator_name VARCHAR(100) NOT NULL,      -- 指标名称
    weight DECIMAL(5,2) NOT NULL,              -- 权重
    max_score DECIMAL(5,2) NOT NULL,           -- 最大分数
    data_source VARCHAR(50) NOT NULL,          -- auto/manual
    scoring_method VARCHAR(50) NOT NULL,       -- linear/step/curve/custom
    scoring_config JSON,                       -- 计算配置
    full_score_standard VARCHAR(255),          -- 满分标准
    is_enabled BOOLEAN DEFAULT true,           -- 是否启用
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (dimension_id) REFERENCES dimension_configs(id)
);
```

#### 表4: 供应商绩效评价表 (supplier_performance)

```sql
CREATE TABLE supplier_performance (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    supplier_id INTEGER NOT NULL,
    supplier_name VARCHAR(255) NOT NULL,
    supplier_type ENUM('purchase', 'external') NOT NULL,
    evaluation_month VARCHAR(7) NOT NULL,
    scheme_id INTEGER,                         -- 使用的评分方案 ⭐
    
    -- 质量维度
    quality_score DECIMAL(5,2) DEFAULT 0,
    batch_pass_rate DECIMAL(5,2),
    defect_rate DECIMAL(5,2),
    return_rate DECIMAL(5,2),
    special_approval_rate DECIMAL(5,2),
    repeat_issues INTEGER DEFAULT 0,
    
    -- 交付维度
    delivery_score DECIMAL(5,2) DEFAULT 0,
    delivery_on_time_rate DECIMAL(5,2),
    delivery_accuracy_rate DECIMAL(5,2),
    
    -- 服务维度
    service_score DECIMAL(5,2) DEFAULT 0,
    document_completeness DECIMAL(5,2),
    document_validity DECIMAL(5,2),
    
    -- 综合评价
    total_score DECIMAL(5,2) NOT NULL,
    grade VARCHAR(2) NOT NULL,
    rank INTEGER,
    trend DECIMAL(5,2),
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(supplier_id, evaluation_month),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    FOREIGN KEY (scheme_id) REFERENCES scoring_schemes(id)
);
```

---

### 后端API设计

#### 配置系统API ⭐ 新增

##### API 1: 获取评分方案列表
```javascript
GET /api/scoring/schemes

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "默认方案",
      "description": "平衡型",
      "isDefault": true
    },
    {
      "id": 2,
      "name": "质量优先方案",
      "description": "质量70%",
      "isDefault": false
    }
  ]
}
```

##### API 2: 获取方案详细配置
```javascript
GET /api/scoring/schemes/:id/config

Response:
{
  "success": true,
  "data": {
    "scheme": { "id": 1, "name": "默认方案" },
    "dimensions": [
      {
        "id": 1,
        "name": "quality",
        "label": "质量维度",
        "weight": 50.0,
        "indicators": [
          {
            "id": 1,
            "name": "batch_pass_rate",
            "label": "批次合格率",
            "weight": 30.0,
            "scoringMethod": "linear",
            "scoringConfig": {
              "fullScoreThreshold": 98,
              "passThreshold": 90,
              "zeroThreshold": 80
            }
          }
        ]
      }
    ]
  }
}
```

##### API 3: 保存方案配置
```javascript
POST /api/scoring/schemes/:id/config
Request:
{
  "dimensions": [
    {
      "id": 1,
      "weight": 60.0,  // 修改权重
      "indicators": [
        {
          "id": 1,
          "scoringConfig": {
            "fullScoreThreshold": 99  // 修改满分标准
          }
        }
      ]
    }
  ]
}
```

##### API 4: 预览评分效果
```javascript
POST /api/scoring/schemes/:id/preview
Request:
{
  "supplierId": 123,
  "month": "2024-11"
}

Response:
{
  "success": true,
  "data": {
    "currentScheme": { "totalScore": 87.5, "grade": "A" },
    "previewScheme": { "totalScore": 89.2, "grade": "A" },
    "difference": +1.7
  }
}
```

---

#### 绩效评价API

##### API 5: 生成月度绩效评价
```javascript
POST /api/performance/generate
Request:
{
  "month": "2024-11",
  "supplierType": "purchase",
  "schemeId": 1  // 使用的评分方案 ⭐
}

Response:
{
  "success": true,
  "message": "已生成45家外购供应商的月度绩效评价",
  "data": {
    "totalSuppliers": 45,
    "averageScore": 87.5,
    "gradeDistribution": {
      "S": 12, "A": 23, "B": 7, "C": 2, "D": 1
    }
  }
}
```

##### API 6: 获取供应商排名
```javascript
GET /api/performance/ranking
Query:
  month: "2024-11"
  supplierType: "purchase"
  page: 1
  pageSize: 20

Response:
{
  "success": true,
  "data": {
    "total": 45,
    "rankings": [
      {
        "rank": 1,
        "supplierId": 123,
        "supplierName": "深圳XX电子",
        "totalScore": 95.2,
        "grade": "S",
        "trend": 2.3
      }
    ]
  }
}
```

##### API 7: 获取数据源统计（双卡片）
```javascript
GET /api/performance/data-source-stats
Query:
  month: "2024-11"

Response:
{
  "success": true,
  "data": {
    "purchase": {
      "totalSuppliers": 45,
      "averageScore": 87.5,
      "excellentCount": 12,
      "needImprovement": 3
    },
    "external": {
      "totalSuppliers": 23,
      "averageScore": 82.3,
      "excellentCount": 6,
      "needImprovement": 5
    }
  }
}
```

---

## 📊 UI/UX设计规范

### 配色方案

```css
/* 等级颜色 */
--grade-s: #10b981;  /* S级 - 翡翠绿 */
--grade-a: #3b82f6;  /* A级 - 蓝色 */
--grade-b: #f59e0b;  /* B级 - 琥珀黄 */
--grade-c: #ff8a4c;  /* C级 - 橙色 */
--grade-d: #ef4444;  /* D级 - 珊瑚红 */

/* 趋势颜色 */
--trend-up: #10b981;
--trend-down: #ef4444;
--trend-flat: #9ca3af;
```

---

## 🚀 实施计划

### Week 1: 数据模型 + 配置系统基础

**Day 1-2: 数据库设计**
- [ ] 创建 `scoring_schemes` 表
- [ ] 创建 `dimension_configs` 表
- [ ] 创建 `indicator_configs` 表
- [ ] 创建 `supplier_performance` 表
- [ ] 初始化默认评分方案

**Day 3-5: 配置系统后端**
- [ ] 评分方案CRUD API
- [ ] 维度配置API
- [ ] 指标配置API
- [ ] 配置预览API

---

### Week 2: 评分引擎 + 配置界面

**Day 6-8: 评分引擎开发**
- [ ] 线性计分算法
- [ ] 阶梯计分算法
- [ ] 曲线计分算法
- [ ] 自定义公式计算
- [ ] 综合评分和等级划分

**Day 9-10: 配置界面开发**
- [ ] 方案管理页面
- [ ] 维度权重配置页面
- [ ] 指标详细配置页面
- [ ] 评分曲线预览组件
- [ ] 配置效果预览功能

---

### Week 3: 绩效评价功能

**Day 11-13: 绩效评价后端**
- [ ] 生成月度评价API
- [ ] 排名生成逻辑
- [ ] 趋势计算
- [ ] 数据源统计API

**Day 14-15: 绩效评价前端**
- [ ] 双卡片数据源组件
- [ ] 供应商排名表
- [ ] 详细评分报告页面
- [ ] 雷达图和趋势图
- [ ] 集成到主系统

---

## ✅ 验收标准

### 配置系统验收 ⭐
- [ ] 能够创建、编辑、删除评分方案
- [ ] 能够调整维度权重，总和必须为100%
- [ ] 能够调整指标权重和满分标准
- [ ] 能够选择不同的计算方式（线性/阶梯/曲线）
- [ ] 能够实时预览配置效果
- [ ] 能够导入/导出配置方案

### 绩效评价验收
- [ ] 能够自动生成外购/外协供应商的月度绩效评价
- [ ] 双卡片正确显示两类供应商的统计信息
- [ ] 排名表正确显示供应商排名和等级
- [ ] 详细报告页面展示完整的评分明细
- [ ] 雷达图和趋势图正确渲染
- [ ] 月份切换功能正常

### 性能验收
- [ ] 45家供应商评价生成时间 < 3秒
- [ ] 配置保存响应时间 < 1秒
- [ ] 排名表加载时间 < 1秒

### 数据准确性验收
- [ ] 评分计算准确（人工抽查10家供应商）
- [ ] 不同配置方案的评分结果正确
- [ ] 排名正确（按总分降序）

---

## 📝 后续扩展

### Phase 2: 功能增强
- [ ] 导出Excel/PDF报告
- [ ] 发送评价邮件给供应商
- [ ] 创建改善任务跟踪
- [ ] 供应商自评功能
- [ ] 配置版本管理（历史记录）⭐

### Phase 3: 智能分析
- [ ] AI预测供应商风险
- [ ] 自动生成改善建议
- [ ] 供应商对比分析
- [ ] 行业基准对比
- [ ] 智能推荐最优配置方案 ⭐

---

**策划完成！准备开始开发喵！** 🎉

---

## 📌 附录

### 附录A: 配置方案模板详情

#### 模板1: 默认方案（平衡型）
```json
{
  "name": "默认方案",
  "dimensions": {
    "quality": { "weight": 50 },
    "delivery": { "weight": 30 },
    "service": { "weight": 20 }
  },
  "indicators": {
    "batch_pass_rate": {
      "weight": 30,
      "fullScoreThreshold": 98,
      "method": "linear"
    }
  }
}
```

#### 模板2: 质量优先方案
```json
{
  "name": "质量优先方案",
  "dimensions": {
    "quality": { "weight": 70 },
    "delivery": { "weight": 20 },
    "service": { "weight": 10 }
  }
}
```

#### 模板3: 交付优先方案
```json
{
  "name": "交付优先方案",
  "dimensions": {
    "quality": { "weight": 40 },
    "delivery": { "weight": 50 },
    "service": { "weight": 10 }
  }
}
```

---

### 附录B: 计算公式详解

#### 线性计分公式
```javascript
function linearScoring(value, config) {
  const { fullScoreThreshold, passThreshold, zeroThreshold, maxScore } = config;
  
  if (value >= fullScoreThreshold) {
    return maxScore;
  } else if (value >= passThreshold) {
    const ratio = (value - passThreshold) / (fullScoreThreshold - passThreshold);
    return passThreshold * maxScore * 0.6 + ratio * maxScore * 0.4;
  } else if (value >= zeroThreshold) {
    const ratio = (value - zeroThreshold) / (passThreshold - zeroThreshold);
    return ratio * maxScore * 0.6;
  } else {
    return 0;
  }
}
```

#### 阶梯计分公式
```javascript
function stepScoring(value, config) {
  for (let i = 0; i < config.steps.length; i++) {
    if (value <= config.steps[i].threshold) {
      return config.steps[i].score;
    }
  }
  return 0;
}
```

---

**文档版本**: v2.0  
**最后更新**: 2025-12-01  
**维护人**: Antigravity AI
