<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQE数据分析助手</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/sheet-styles.css">
    <link rel="stylesheet" href="css/loading.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <h1>SQE数据分析助手</h1>
            <p>基于IQC来料检验台账的智能分析工具</p>
        </header>

        <section class="upload-section">
            <h2>上传IQC检验数据</h2>
            <p>请上传IQC检验数据Excel文件</p>
            <form id="uploadForm" enctype="multipart/form-data">
                <input type="file" id="excelFile" name="excelFile" accept=".xlsx, .xls" required>
                <div id="sheetSelection" class="sheet-selection hidden">
                    <div class="sheet-selection-card">
                        <h3>📋 选择要分析的工作表</h3>
                        <p class="sheet-hint">检测到多个工作表，请选择需要分析的数据表</p>
                        <div class="sheet-tab-buttons" id="sheetTabContainer"></div>
                        <select id="sheetSelect" class="hidden"></select>
                        <button type="button" id="confirmSheetBtn" class="confirm-sheet-btn">开始分析</button>
                    </div>
                </div>
                <button type="submit" id="uploadBtn">上传并分析</button>
            </form>
            <div id="loading" class="loading hidden">
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">正在分析数据...</div>
                    <div class="progress-bar">
                        <div class="progress-bar-fill"></div>
                    </div>
                    <div class="loading-tips">请稍候，正在处理您的Excel文件</div>
                </div>
            </div>
        </section>

        <section id="supplierSearch" class="supplier-search-section hidden">
            <h2>供应商搜索</h2>
            <div class="search-controls">
                <input type="text" id="supplierSearchInput" list="supplierOptions" placeholder="输入供应商名称">
                <datalist id="supplierOptions"></datalist>

                <button id="searchSupplierBtn">搜索供应商</button>
                <button id="showAllBtn">显示全部</button>
            </div>
        </section>

        <section id="results" class="results-section hidden">
            <h2>分析结果</h2>

            <div class="summary-stats">
                <div class="stat-card">
                    <h3>总批次数</h3>
                    <p id="totalBatches">-</p>
                </div>
                <div class="stat-card">
                    <h3>合格批次数</h3>
                    <p id="okBatches">-</p>
                </div>
                <div class="stat-card">
                    <h3>退货批次数</h3>
                    <p id="returnBatches">-</p>
                </div>
                <div class="stat-card">
                    <h3>特采批次数</h3>
                    <p id="specialBatches">-</p>
                </div>
                <div class="stat-card">
                    <h3>批次合格率</h3>
                    <p id="passRate">-%</p>
                </div>
            </div>

            <div class="chart-container-pie">
                <h3>缺陷类型分布</h3>
                <canvas id="defectDistributionChart"></canvas>
            </div>

            <div class="monthly-stats">
                <h3>月度统计</h3>
                <div id="monthlyData"></div>
            </div>

            <div class="time-comparison-container">
                <h3>周度数据对比</h3>

                <div class="week-selection-section">
                    <h4>自定义时间段对比</h4>
                    <div class="date-ranges-selector">

                        <div class="current-period-selector">

                            <label for="currentPeriodStart">本周时间段:</label>

                            <input type="date" id="currentPeriodStart">

                            <span>至</span>

                            <input type="date" id="currentPeriodEnd">

                        </div>



                        <div class="previous-period-selector">

                            <label for="previousPeriodStart">上周时间段:</label>

                            <input type="date" id="previousPeriodStart">

                            <span>至</span>

                            <input type="date" id="previousPeriodEnd">

                        </div>



                        <div class="comparison-buttons">

                            <button id="compareBtn">自定义对比</button>

                            <button id="resetBtn">恢复默认</button>

                        </div>
                    </div>

                    <div class="week-data-comparison">
                        <div class="week-data-section">
                            <h4 id="currentPeriodTitle">本周数据 (上周五至本周四)</h4>
                            <div id="currentWeekData">
                                <p>总批次数: <span id="currentWeekTotal">-</span></p>
                                <p>合格批次数: <span id="currentWeekOk">-</span></p>
                                <p>退货批次数: <span id="currentWeekReturn">-</span></p>
                                <p>特采批次数: <span id="currentWeekSpecial">-</span></p>
                                <p class="pass-rate-highlight">批次合格率: <span id="currentWeekPassRate">-%</span></p>
                            </div>
                        </div>

                        <div class="week-data-section">
                            <h4 id="previousPeriodTitle">上周数据 (上上周五至上周四)</h4>
                            <div id="previousWeekData">
                                <p>总批次数: <span id="previousWeekTotal">-</span></p>
                                <p>合格批次数: <span id="previousWeekOk">-</span></p>
                                <p>退货批次数: <span id="previousWeekReturn">-</span></p>
                                <p>特采批次数: <span id="previousWeekSpecial">-</span></p>
                                <p class="pass-rate-highlight">批次合格率: <span id="previousWeekPassRate">-%</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-container-full-width">
                <h3>平均合格率趋势</h3>
                <canvas id="monthlyTrendChart"></canvas>
                <div class="data-table-container">
                    <h3>平均合格率明细</h3>
                    <div class="table-wrapper">
                        <table id="cumulativePassRateTable">
                            <thead>
                                <tr>
                                    <th>月份</th>
                                    <th>批次数</th>
                                    <th>合格数</th>
                                    <th>特采数</th>
                                    <th>批退数</th>
                                    <th>当月合格率(%)</th>
                                    <th>平均合格率(%)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将由JavaScript填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="chart-container-full-width" id="supplier-ranking-container">
                <h3>供应商良率排名</h3>
                <canvas id="supplierDefectRateChart"></canvas>
            </div>


        </section>

        <section id="error" class="error-section hidden">
            <h2>错误</h2>
            <p id="errorMessage"></p>
        </section>
    </div>

    <script src="js/api.js"></script>
    <script src="js/toast.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js?v=1.0.6"></script>
</body>

</html>