<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>供应商资料管理 - SQE系统</title>
    <link rel="stylesheet" href="../css/style_v2.css">
    <link rel="stylesheet" href="../css/modules/documents.css">
</head>
<body>
    <div class="app-container">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>SQE系统</h2>
            </div>
            
            <nav class="sidebar-nav">
                <a href="../index.html" class="nav-item">
                    <span class="nav-icon">📊</span>
                    <span class="nav-text">IQC数据分析</span>
                </a>
                <a href="documents.html" class="nav-item active">
                    <span class="nav-icon">📋</span>
                    <span class="nav-text">供应商资料管理</span>
                </a>
            </nav>

            <!-- 用户信息 -->
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">A</div>
                <div class="user-details">
                    <div class="user-name" id="userName">管理员</div>
                    <button class="logout-btn" id="logoutBtn">退出</button>
                </div>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 顶部工具栏 -->
            <header class="content-header">
                <div class="header-left">
                    <h1>供应商资料管理</h1>
                </div>
                
                <div class="header-right">
                    <button class="btn btn-primary" id="uploadBtn">
                        <span class="btn-icon">📤</span>
                        上传资料
                    </button>
                    <button class="btn btn-secondary" id="refreshBtn">
                        <span class="btn-icon">🔄</span>
                        刷新
                    </button>
                </div>
            </header>

            <!-- 筛选区域 -->
            <section class="filters-section">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="supplierSelect">供应商</label>
                        <select id="supplierSelect" class="form-control">
                            <option value="">全部供应商</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="statusFilter">状态</label>
                        <select id="statusFilter" class="form-control">
                            <option value="">全部状态</option>
                            <option value="active">有效</option>
                            <option value="expired">已过期</option>
                            <option value="archived">已归档</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="searchInput">搜索</label>
                        <input type="text" id="searchInput" class="form-control" placeholder="搜索资料名称...">
                    </div>
                </div>
            </section>

            <!-- 资料类型标签 -->
            <section class="document-types">
                <div class="type-tabs">
                    <button class="document-type-tab active" data-type="quality_agreement">
                        <span class="tab-icon">📋</span>
                        <span class="tab-text">质保协议</span>
                    </button>
                    <button class="document-type-tab" data-type="environmental_rohs">
                        <span class="tab-icon">🌱</span>
                        <span class="tab-text">环保ROHS</span>
                    </button>
                    <button class="document-type-tab" data-type="environmental_reach">
                        <span class="tab-icon">🌱</span>
                        <span class="tab-text">环保REACH</span>
                    </button>
                    <button class="document-type-tab" data-type="environmental_msds">
                        <span class="tab-icon">🌱</span>
                        <span class="tab-text">环保MSDS</span>
                    </button>
                </div>
            </section>

            <!-- 资料列表 -->
            <section class="documents-section">
                <div class="section-header">
                    <h2>资料列表</h2>
                    <div class="section-actions">
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="grid">
                                <span class="view-icon">⊞</span>
                            </button>
                            <button class="view-btn" data-view="list">
                                <span class="view-icon">☰</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="documents-container" id="documentsContainer">
                    <!-- 资料卡片将在这里动态生成 -->
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">加载中...</div>
                    </div>
                </div>

                <!-- 分页 -->
                <div class="pagination-container" id="paginationContainer">
                    <!-- 分页按钮将在这里动态生成 -->
                </div>
            </section>
        </main>
    </div>

    <!-- 上传模态框 -->
    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>上传资料</h3>
                <button class="modal-close" onclick="supplierManager.hideUploadModal()">×</button>
            </div>
            
            <div class="modal-body">
                <form id="uploadForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="uploadSupplierId">供应商 *</label>
                            <select id="uploadSupplierId" class="form-control" required>
                                <option value="">请选择供应商</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="uploadDocumentType">资料类型 *</label>
                            <select id="uploadDocumentType" class="form-control" required>
                                <option value="">请选择资料类型</option>
                                <option value="quality_agreement">质保协议</option>
                                <option value="environmental_rohs">环保ROHS</option>
                                <option value="environmental_reach">环保REACH</option>
                                <option value="environmental_msds">环保MSDS</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="uploadDocumentName">资料名称 *</label>
                        <input type="text" id="uploadDocumentName" class="form-control" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="uploadDocumentNumber">协议编号</label>
                            <input type="text" id="uploadDocumentNumber" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="uploadExpiryDate">到期日期</label>
                            <input type="date" id="uploadExpiryDate" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="uploadResponsiblePerson">责任人</label>
                            <input type="text" id="uploadResponsiblePerson" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="uploadIssuingAuthority">发证机构</label>
                            <input type="text" id="uploadIssuingAuthority" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="uploadRemarks">备注</label>
                        <textarea id="uploadRemarks" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>文件上传 *</label>
                        <div class="file-upload-area" id="uploadDropZone">
                            <div class="upload-icon">📤</div>
                            <div class="upload-text">
                                <p>拖拽文件到此处或点击选择文件</p>
                                <p class="upload-hint">支持 PDF, DOC, DOCX, XLS, XLSX, JPG, PNG 格式，最大100MB</p>
                            </div>
                            <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png" hidden>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="supplierManager.hideUploadModal()">取消</button>
                <button type="button" class="btn btn-primary" onclick="supplierManager.submitUpload()">上传</button>
            </div>
        </div>
    </div>

    <!-- 编辑模态框 -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>编辑资料</h3>
                <button class="modal-close" onclick="supplierManager.hideEditModal()">×</button>
            </div>
            
            <div class="modal-body">
                <form id="editForm">
                    <input type="hidden" id="editDocumentId">
                    
                    <div class="form-group">
                        <label for="editDocumentName">资料名称 *</label>
                        <input type="text" id="editDocumentName" class="form-control" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editDocumentNumber">协议编号</label>
                            <input type="text" id="editDocumentNumber" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="editExpiryDate">到期日期</label>
                            <input type="date" id="editExpiryDate" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editResponsiblePerson">责任人</label>
                            <input type="text" id="editResponsiblePerson" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="editIssuingAuthority">发证机构</label>
                            <input type="text" id="editIssuingAuthority" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editRemarks">备注</label>
                        <textarea id="editRemarks" class="form-control" rows="3"></textarea>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="supplierManager.hideEditModal()">取消</button>
                <button type="button" class="btn btn-primary" onclick="supplierManager.submitEdit()">保存</button>
            </div>
        </div>
    </div>

    <!-- 脚本 -->
    <script src="../js/auth.js"></script>
    <script src="../js/modules/supplier.js"></script>
    <script>
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 检查认证状态
            checkAuthentication();
        });

        // 视图切换
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                
                const view = e.target.dataset.view;
                const container = document.getElementById('documentsContainer');
                container.className = `documents-container view-${view}`;
            });
        });

        // 模态框外部点击关闭
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>