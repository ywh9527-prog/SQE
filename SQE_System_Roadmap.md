# SQE 供应商管理系统 v2.0 改版计划清单

**最新更新**: 2025-11-21 | **整体进度**: Phase 1 基本完成 (⭐⭐⭐⭐ 4/5)

---

## 📌 状态标识说明

**任务状态**: ✅ 已完成 | 🟡 进行中 | ⬜ 未开始  
**优先级**: 🔴 高优先级 | 🟡 中优先级 | 🟢 低优先级

---

## 📊 项目进度概览

| Phase | 名称 | 状态 | 完成度 | 备注 |
|-------|------|------|--------|------|
| **Phase 1** | 架构设计与基础重构 | 🟡 进行中 | 85% | 核心架构完成，待优化细节 |
| **Phase 1.5** | 桌面端环境搭建 | ⬜ 未开始 | 0% | Electron 已安装，待配置 |
| **Phase 2** | 供应商档案与预警 | ⬜ 未开始 | 0% | 依赖 Phase 1 完成 |
| **Phase 3** | 绩效评价与高级功能 | ⬜ 未开始 | 0% | 依赖 Phase 2 完成 |

---

## 1. 产品定位与核心目标 (Product Vision)

打造一款**专业、智能、自动化**的 SQE 供应商全生命周期管理系统。
从单一的 IQC 数据分析工具，转型为集**档案管理、资质预警、绩效评价、自动交互**于一体的企业级质量管理平台。

**核心关键词**：
*   **专业性 (Professional)**：符合 ISO9001/IATF16949 质量管理体系要求。
*   **智能化 (Intelligent)**：自动预警、自动邮件、智能评分。
*   **高级感 (Premium)**：现代化的 UI/UX 设计，操作流畅，视觉愉悦。

---

## 2. UI/UX 设计系统 (Design System)

### 实际采用方案 (2025-11-21 更新)

**配色方案**: Mocha Mousse (摩卡慕斯) - Pantone 2025 年度色
*   **主色系**：
    *   `--primary-500: #9d7a54` (摩卡棕)
    *   `--primary-700: #6b4e3d` (深棕)
    *   `--primary-900: #4d392f` (最深棕)
*   **强调色**：活力橙 `#ff6b35`
*   **语义色**：
    *   成功/优秀：翡翠绿 `#10b981`
    *   警告/临期：琥珀黄 `#f59e0b`
    *   危险/过期：珊瑚红 `#ef4444`
    *   信息：蓝色 `#3b82f6`

**布局系统**:
*   ✅ 侧边栏 + 内容区（已完成）
*   ✅ SPA 单页应用架构（Hash 路由）
*   ✅ 响应式设计（1024px、768px 断点）

**交互组件**:
*   ✅ 卡片式设计
*   ✅ 悬浮效果与微动效
*   ⚠️ Toast 通知（当前使用 alert，待优化）
*   ❌ Modal 模态框（待开发）
*   ❌ 骨架屏（待开发）

---

## 3. 详细实施进度表 (Implementation Progress Tracker)

> **说明**：此表为项目推进的"活文档"。

### Phase 1: 架构设计与基础重构 (Architecture Design & Foundation Refactor)

**最新核实时间**: 2025-11-21 | **整体完成度**: ⭐⭐⭐⭐ (4/5) | **状态**: 🟡 基本完成，待优化

| 状态 | ID | 任务名称 | 详细描述 | 备注 |
| :---: | :--- | :--- | :--- | :--- |
| 🟡 | **1.0** | **模块化架构设计** | 确立模块化原则，创建目录结构，制定BEM命名规范，提取共享组件 | **部分完成** - 目录结构已建立，BEM规范待统一 |
| ✅ | **1.0.1** | **目录结构建立** | 创建 `public/js/modules/`, `public/css/modules/`, `public/js/utils/` 目录 | **已完成** - 目录结构完整 |
| 🟡 | **1.0.2** | **代码强制分离** | 现有代码(IQC/供应商等)必须完全重构为独立模块，禁止混合编写 | **进行中** - `iqc.js` 已独立，但 `main.js` 存在逻辑重复 ⚠️ |
| ✅ | **1.0.2.1** | **🔴 main.js 重构** | **删除 `main.js` 中与 `iqc.js` 重复的业务逻辑**（上传、搜索、对比等），确保单一职责 | **✅ 已完成** - main.js 已重命名为 main.js.backup，系统完全使用模块化架构 |
| ⬜ | **1.0.2.2** | **ui.js 优化** | 将 IQC 专用的 UI 渲染逻辑迁移到 `iqc.js`，`ui.js` 只保留通用工具函数 | **🟡 中优先级** - 当前 411 行，接近重构阈值（500行） |
| 🟡 | **1.0.3** | **共享组件提取** | 创建 `public/js/utils/api.js`, `public/js/utils/modal.js`, `public/js/utils/toast.js` | **部分完成** - `api_core.js` 已完成，缺少 `modal.js`, `toast.js` |
| ⬜ | **1.0.3.1** | **🟡 Toast 组件开发** | 实现专业的 Toast 通知组件，替换所有 `alert()` 调用 | **🟡 中优先级** - 提升用户体验，符合现代 Web 应用标准 |
| ⬜ | **1.0.3.2** | **Modal 组件开发** | 实现通用的模态框组件，供供应商详情、表单编辑等场景使用 | **🟢 低优先级** - Phase 2 需要 |
| 🟡 | **1.0.4** | **BEM命名规范** | 制定并实施严格的BEM命名规范，避免样式冲突 | **部分完成** - 部分样式已遵循，需统一命名空间 |
| ⬜ | **1.0.4.1** | **CSS 命名规范统一** | 创建 `CSS_NAMING_GUIDE.md`，统一模块样式命名（如 `.iqc-card`, `.supplier-card`） | **🟡 中优先级** - 避免未来模块样式冲突 |
| ✅ | **1.0.5** | **模块依赖管理** | 建立模块间依赖规则，禁止跨模块直接调用，统一通过 `window.App` 命名空间 | **已完成** - 通过 `window.App` 管理模块依赖 |
| ⬜ | **1.0.6** | **🟢 旧文件清理** | 删除/归档旧版文件：`iqc.css`, `index_legacy.html`, 优化后的 `main.js` | **🟢 低优先级** - 代码库整洁 |
| ✅ | **1.1** | **后端架构重组** | 建立 `server/models`, `server/database` 目录；配置 Sequelize ORM | **已完成** - 目录结构已建立 |
| ⬜ | **1.2** | **ORM数据建模** | 使用 Sequelize 定义 `Suppliers` 和 `Certificates` 模型，支持自动迁移 | **待开始** - Phase 2 前置任务 |
| ✅ | **1.3** | **前端模块化布局** | 重写 `index.html`，实现**侧边栏 + 内容区**布局，各模块独立容器 | **已完成** - 侧边栏 + 内容区布局完美实现 ⭐⭐⭐⭐⭐ |
| ✅ | **1.4** | **模块化样式系统** | 编写模块化CSS，采用 Mocha Mousse 主色调，卡片式设计风格 | **已完成** - `style_v2.css` + `iqc_v2.css`，设计系统专业 ⭐⭐⭐⭐ |
| ✅ | **1.5** | **模块化路由系统** | 实现基于模块的Hash路由，支持动态加载模块 | **已完成** - `router.js` 实现轻量级 Hash 路由 ⭐⭐⭐⭐⭐ |
| ✅ | **1.6** | **IQC模块重构** | 将现有IQC功能重构为独立模块 `public/js/modules/iqc.js` | **已完成** - 代码结构优秀，可作为其他模块模板 ⭐⭐⭐⭐⭐ |

### Phase 1.5: 桌面端环境搭建 (Electron Integration)

| 状态 | ID | 任务名称 | 详细描述 | 备注 |
| :---: | :--- | :--- | :--- | :--- |
| 🟡 | **1.7** | **Electron 初始化** | 安装 Electron，配置 `electron-main.js` 主进程，实现窗口创建 | **部分完成** - Electron 已安装，`electron-main.js` 已存在，待完整配置 |
| ⬜ | **1.8** | **环境适配** | 调整数据库路径和文件读写逻辑，确保在 Electron 打包环境下正常运行 | 待 Electron 完整配置后进行 |
| ⬜ | **1.9** | **初步打包验证** | 使用 `electron-builder` 打包第一个 `.exe` 版本，验证安装和运行 | 待开始 |

### Phase 2: 供应商档案与预警 (Supplier Profile & Alerts)

**前置条件**: Phase 1 完成度 ≥ 95%

| 状态 | ID | 任务名称 | 详细描述 | 备注 |
| :---: | :--- | :--- | :--- | :--- |
| ⬜ | **2.1** | **供应商模块开发** | 创建 `public/js/modules/supplier.js`，实现供应商档案管理逻辑 | 基于Phase 1.0的模块化架构 |
| ⬜ | **2.2** | **后端 CRUD 接口** | 开发 `GET/POST/PUT/DELETE /api/suppliers` 接口，实现供应商增删改查 | 待开始 |
| ⬜ | **2.3** | **供应商列表页** | 开发前端表格页面，支持分页、搜索、按等级筛选供应商 | 使用共享组件，遵循BEM规范 |
| ⬜ | **2.4** | **供应商详情页** | 开发详情模态框，展示基本信息、证书列表、历史绩效概览 | 使用共享模态框组件 |
| ⬜ | **2.5** | **证书管理功能** | 实现证书文件上传、有效期录入、状态显示（正常/临期/过期） | 待开始 |
| ⬜ | **2.6** | **邮件服务集成** | 配置 `nodemailer`，封装通用的邮件发送函数 `sendEmail(to, subject, content)` | 待开始 |
| ⬜ | **2.7** | **自动预警逻辑** | 编写定时任务脚本，每日扫描过期证书并触发邮件发送 | 待开始 |

### Phase 3: 绩效评价与高级功能 (Performance & Advanced)

| 状态 | ID | 任务名称 | 详细描述 | 备注 |
| :---: | :--- | :--- | :--- | :--- |
| ⬜ | **3.1** | **绩效模块开发** | 创建 `public/js/modules/performance.js`，实现绩效评价逻辑 | 基于Phase 1.0的模块化架构 |
| ⬜ | **3.2** | **绩效模型配置** | 建立绩效评分规则表，定义各维度（质量、交付、服务）的权重和计算公式 | 待开始 |
| ⬜ | **3.3** | **自动评分引擎** | 开发后端逻辑，每月自动从 IQC 数据中提取合格率并计算质量得分 | 待开始 |
| ⬜ | **3.4** | **绩效报表前端** | 开发绩效仪表盘，展示雷达图、趋势图和月度评分卡 | 使用共享图表组件，遵循BEM规范 |

---

## 4. 当前待解决问题 (Current Issues)

### 🔴 高优先级问题

1. **main.js 与 iqc.js 逻辑重复**
   - **现状**: 两个文件都包含上传、搜索、对比等逻辑
   - **风险**: 修改一处逻辑，另一处可能遗漏；难以定位 bug
   - **解决方案**: 将 main.js 中的所有 IQC 相关逻辑删除，只保留全局初始化和路由注册
   - **工作量**: 2-3 小时

### 🟡 中优先级问题

2. **缺少专业 Toast 组件**
   - **现状**: 使用 `alert()` 显示提示信息
   - **影响**: 用户体验差，不符合现代 Web 应用标准
   - **解决方案**: 创建 `public/js/utils/toast.js`，实现轻量级 Toast 组件
   - **工作量**: 1-2 小时

3. **CSS 命名规范不统一**
   - **现状**: 部分类名未遵循 BEM 规范
   - **影响**: 未来模块可能出现样式冲突
   - **解决方案**: 创建 `CSS_NAMING_GUIDE.md`，统一命名空间
   - **工作量**: 1 小时

### 🟢 低优先级问题

4. **旧文件清理**
   - 需要删除/归档：`iqc.css`, `index_legacy.html`
   - **工作量**: 0.5 小时

---

## 5. 下一步行动计划 (Next Actions)

### 本周任务（优先级排序）

1. **🔴 重构 main.js**（必须完成）
   - 删除 IQC 相关逻辑
   - 确保 iqc.js 正常工作
   - 测试所有功能

2. **🟡 实现 Toast 组件**
   - 创建 `toast.js`
   - 替换所有 `alert()`
   - 添加成功/警告/错误样式

3. **🟡 统一 BEM 命名**
   - 创建 CSS 命名指南
   - 重命名关键样式类

4. **🟢 文件清理**
   - 删除旧版文件
   - 更新引用

### 下周任务

- 开始 Phase 2：供应商模块开发
- ORM 数据建模
- 供应商 CRUD 接口

---

## 6. 架构原则 (Architectural Principles)

### 模块化隔离原则

为了避免系统复杂度增加导致"牵一发而动全身"的问题，严格遵循以下原则：

**核心原则**:
*   **独立性 (Independence)**：每个业务模块（IQC、供应商档案、绩效、审核）应视为独立的子系统，拥有独立的代码空间。
*   **解耦 (Decoupling)**：修改一个模块的 UI 或逻辑，绝不应影响其他模块的运行。

**实施规范**:
1.  **独立 JS 文件**：
    *   严禁将所有逻辑堆砌在 `main.js` 或 `ui.js` 中。
    *   每个模块必须有独立的控制器文件，例如：
        *   `public/js/modules/iqc.js` (负责 IQC 分析逻辑)
        *   `public/js/modules/supplier.js` (负责供应商档案逻辑)
        *   `public/js/modules/performance.js` (负责绩效评价逻辑)
2.  **独立 CSS 或命名空间**：
    *   每个模块的样式应独立文件（如 `public/css/modules/iqc_v2.css`）。
    *   或者在 `style.css` 中使用严格的 BEM 命名空间（如 `.iqc-container__chart`, `.supplier-card__title`）。
3.  **共享组件提取**：
    *   通用功能（API 请求封装、Loading 动画、模态框基类、工具函数）提取到 `public/js/utils/` 目录。
4.  **重构阈值**：
    *   当单文件超过 500 行，或包含 >2 个业务模块逻辑时，强制触发拆分重构。

---

## 7. 桌面端迁移策略 (Desktop Application Strategy)

**好消息**：现有的技术栈 (Node.js + HTML/CSS/JS) 转换成桌面端非常方便，几乎是无缝衔接。

我们将使用 **Electron** 框架来实现这一目标。

### 为什么选择 Electron？

1.  **代码复用率 99%**：Electron 的核心就是 Chromium 浏览器 + Node.js。我们现在写的 HTML/CSS/JS 前端代码可以直接在 Electron 中运行，无需重写。
2.  **原生能力**：Electron 可以让网页调用 Windows 系统底层能力，比如：
    *   **文件系统**：直接读取本地 Excel，不再需要"上传"这个动作，体验更像原生软件。
    *   **系统通知**：直接弹出 Windows 右下角通知，而不仅仅是网页弹窗。
    *   **开机自启**：可以设置为开机自动后台运行，默默监控证书过期情况。
3.  **离线运行**：数据库 (SQLite) 本地化后，软件可以在无网络环境下（内网）完美运行。

### 迁移步骤预览

1.  **安装 Electron**：`npm install electron --save-dev` ✅ 已完成
2.  **配置入口**：创建一个 `electron-main.js` (Electron 主进程)，负责创建窗口并加载我们的 `index.html`。
3.  **调整 API 调用**：
    *   目前的 API 是通过 HTTP 请求 (`fetch('/api/...')`) 调用后端。
    *   在 Electron 中，我们可以保留 HTTP 模式（在本地启动一个微型服务器），也可以使用 **IPC (进程间通信)** 直接调用控制器函数，后者性能更好且无需占用端口。
4.  **打包发布**：使用 `electron-builder` 将项目打包成 `.exe` 安装包，支持自定义图标、安装向导等。

**结论**：我们现在所做的每一步 Web 开发工作，都是在为未来的桌面端打基础。**现在的代码完全不会浪费**，未来只需加一层"壳"即可华丽转身为桌面软件。

---

**文档维护**: 本文档将持续更新，记录项目进度和重要决策。
**最后更新**: 2025-11-21