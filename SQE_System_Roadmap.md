# SQE 供应商管理系统 v2.0 改版计划清单

## 1. 产品定位与核心目标 (Product Vision)
打造一款**专业、智能、自动化**的 SQE 供应商全生命周期管理系统。
从单一的 IQC 数据分析工具，转型为集**档案管理、资质预警、绩效评价、自动交互**于一体的企业级质量管理平台。

**核心关键词**：
*   **专业性 (Professional)**：符合 ISO9001/IATF16949 质量管理体系要求。
*   **智能化 (Intelligent)**：自动预警、自动邮件、智能评分。
*   **高级感 (Premium)**：现代化的 UI/UX 设计，操作流畅，视觉愉悦。

---

## 2. 详细功能模块规划 (Feature Roadmap)

### 2.1 供应商档案中心 (Supplier Master Data)
*   **基础信息管理**：
    *   供应商编码、名称、联系人、地址、结算方式等。
    *   支持 Excel 批量导入/导出。
*   **分级管理 (Classification)**：
    *   **战略级 / 核心级 / 一般级 / 淘汰级**。
    *   不同级别对应不同的管理策略（如审核频率、抽检比例）。
    *   支持自定义标签（如：关键物料、风险供应商）。
*   **资质证书管理 (Certificate Management)**：
    *   上传/管理 ISO9001, IATF16949, ISO14001 等证书。
    *   **智能预警**：证书过期前 30/60/90 天自动触发预警。

### 2.2 智能预警与交互系统 (Alert & Interaction)
*   **自动化邮件机器人**：
    *   **场景 1（资质过期）**：检测到证书即将过期 -> 自动发送邮件给供应商联系人 -> 抄送 SQE -> 记录发送日志。
    *   **场景 2（绩效不达标）**：月度绩效生成后，若低于标准 -> 自动发送整改通知单 (SCAR)。
*   **系统内消息中心**：
    *   首页 Dashboard 显示待办事项（如：3 家供应商证书本月过期，5 份 SCAR 待回复）。

### 2.3 供应商绩效评价 (Performance Evaluation)
*   **多维度评分模型**：
    *   **质量 (Quality)**：自动从 IQC 数据获取合格率、退货率（权重 40%）。
    *   **交付 (Delivery)**：对接 ERP 数据或手动录入准时交货率（权重 30%）。
    *   **服务 (Service)**：配合度、回复速度（人工打分，权重 15%）。
    *   **成本 (Cost)**：价格竞争力（人工打分，权重 15%）。
*   **自动化月报**：
    *   每月 1 号自动计算上月得分，生成《供应商月度绩效卡》。
    *   生成排名榜单（红黑榜）。

### 2.4 供应商审核管理 (Audit Management)
*   **审核计划**：年度审核计划表（甘特图视图）。
*   **移动端评分**：支持平板/手机现场打分，上传照片。
*   **问题点追踪**：审核发现的不符合项 (NC) 自动转入"待整改"列表，追踪关闭闭环。

---

## 3. 技术架构升级 (Technical Architecture)

### 3.1 后端 (Node.js + Express)
*   **数据库架构策略**：
    *   **ORM优先原则**：使用 **Sequelize** ORM 库，避免直接写 SQL 语句
    *   **迁移无痛化**：SQLite → MySQL/PostgreSQL 只需改配置，业务代码零修改
    *   **数据共享设计**：企业级系统需要统一数据源，避免数据孤岛
    *   **分阶段部署**：
        - **Phase 1**: SQLite + Sequelize (开发/单机版)
        - **Phase 2**: MySQL/PostgreSQL + Sequelize (企业版，支持多用户)
    *   **ORM优势**：
        - `Supplier.findAll()` 自动翻译为对应数据库语法
        - 类型安全、自动迁移、关联关系管理
        - 统一的查询API，无需关心底层数据库差异
*   **邮件服务**：
    *   集成 `nodemailer`，配置企业邮箱 SMTP 服务。
*   **定时任务**：
    *   引入 `node-schedule`，每天凌晨扫描过期证书，每月初计算绩效。
*   **API 规范化**：
    *   RESTful API 设计 (`GET /api/suppliers`, `POST /api/suppliers/:id/certificates`)。

### 3.2 前端 (HTML5 + CSS3 + JS)
*   **SPA 架构 (单页应用)**：
    *   虽然不使用 React/Vue 框架（保持轻量），但采用**组件化思维**重构 `ui.js`。
    *   引入前端路由逻辑（Hash 路由），实现无刷新页面切换。
*   **UI 框架升级**：
    *   **侧边栏导航 (Sidebar)**：左侧固定导航，右侧内容区域。
    *   **卡片式设计 (Card UI)**：所有信息块采用悬浮卡片，阴影深度分层。
    *   **数据可视化**：继续强化 Chart.js 的使用，增加雷达图（绩效维度）、仪表盘（综合得分）。
*   **交互体验**：
    *   **Toast 通知**：操作成功/失败的右上角弹窗。
    *   **Modal 模态框**：表单填写、详情查看全部使用模态框，保持上下文。
    *   **骨架屏 (Skeleton)**：数据加载时显示占位符，提升流畅感。

---

## 4. UI/UX 设计风格指南 (Design System)

*   **配色方案**：
    *   **主色调**：藏青色 (#1a365d) -> 高端沉稳。
    *   **强调色**：活力橙 (#ff6b35) -> 现代感强、交互链接。
    *   **辅助色**：
        *   成功/优秀：翡翠绿 (#27ae60)
        *   警告/即将过期：琥珀黄 (#f39c12)
        *   危险/已过期/不合格：珊瑚红 (#e74c3c)
    *   **背景色**：极简灰 (#f5f7fa) -> 减少视觉疲劳。
*   **排版**：
    *   字体：Inter / Roboto / 苹方 (系统默认无衬线字体)。
    *   层级：通过字号、字重、颜色深浅严格区分信息层级。

---

## 5. 实施阶段规划 (Phased Implementation)

### Phase 1: 基础架构重构 (本周目标)
1.  **数据库初始化**：建立 SQLite 数据库，设计 `Suppliers`, `Certificates` 表结构。
2.  **UI 框架搭建**：重写 `index.html` 和 `style.css`，实现侧边栏布局。
3.  **数据迁移**：将现有的 IQC 分析功能迁移到新布局的"质量分析"模块中。

### Phase 2: 供应商档案与预警 (下周目标)
1.  **档案管理**：实现供应商增删改查 (CRUD)。
2.  **证书管理**：实现证书上传、有效期录入。
3.  **邮件系统**：配置邮件服务，实现过期自动预警功能。

### Phase 3: 绩效与审核 (未来规划)
1.  **绩效模型**：建立评分公式，实现自动计算。
2.  **审核模块**：开发审核计划和评分表。

---

**作为产品经理的建议**：
我们不要试图一次性完成所有功能。**Phase 1 (基础架构重构)** 是最关键的。我们需要先让现在的 IQC 分析功能在一个更"高级"的壳子里运行起来，然后再往里面填充新的"供应商管理"血肉。


---

## 6. 详细实施进度表 (Implementation Progress Tracker)

> **说明**：此表将作为项目推进的"活文档"。每完成一个子任务，状态将从 ⬜ (未开始) 更新为 ✅ (已完成)，并在备注中记录关键产出。

### Phase 1: 架构设计与基础重构 (Architecture Design & Foundation Refactor)
| ID | 任务名称 | 详细描述 | 状态 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **1.0** | **模块化架构设计** | 确立模块化原则，创建目录结构，制定BEM命名规范，提取共享组件 | ⬜ | **优先级最高** - 为后续开发奠定正确基础 |
| **1.0.1** | **目录结构建立** | 创建 `public/js/modules/`, `public/css/modules/`, `public/js/utils/` 目录 | ⬜ | 待开始 |
| **1.0.2** | **代码强制分离** | 现有代码(IQC/供应商等)必须完全重构为独立模块，禁止混合编写 | ⬜ | **核心要求** - 避免"牵一发而动全身" |
| **1.0.3** | **共享组件提取** | 创建 `public/js/utils/api.js`, `public/js/utils/modal.js`, `public/js/utils/loading.js` | ⬜ | 待开始 |
| **1.0.4** | **BEM命名规范** | 制定并实施严格的BEM命名规范，避免样式冲突 | ⬜ | 待开始 |
| **1.0.5** | **模块依赖管理** | 建立模块间依赖规则，禁止跨模块直接调用，统一通过事件总线 | ⬜ | 待开始 |
| **1.1** | **后端架构重组** | 建立 `server/models`, `server/database` 目录；配置 Sequelize ORM | ⬜ | **ORM优先** - 统一数据访问层 |
| **1.2** | **ORM数据建模** | 使用 Sequelize 定义 `Suppliers` 和 `Certificates` 模型，支持自动迁移 | ⬜ | **类型安全** - 避免直接SQL |
| **1.3** | **前端模块化布局** | 重写 `index.html`，实现**侧边栏 + 内容区**布局，各模块独立容器 | ⬜ | 待开始 |
| **1.4** | **模块化样式系统** | 编写模块化CSS，确立藏青色主色调和活力橙强调色，卡片式设计风格 | ⬜ | 待开始 |
| **1.5** | **模块化路由系统** | 实现基于模块的Hash路由，支持动态加载模块 | ⬜ | 待开始 |
| **1.6** | **IQC模块重构** | 将现有IQC功能重构为独立模块 `public/js/modules/iqc.js` | ⬜ | 待开始 |

### Phase 1.5: 桌面端环境搭建 (Electron Integration)
| ID | 任务名称 | 详细描述 | 状态 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **1.7** | **Electron 初始化** | 安装 Electron，配置 `main.js` 主进程，实现窗口创建 | ⬜ | 待开始 |
| **1.8** | **环境适配** | 调整数据库路径和文件读写逻辑，确保在 Electron 打包环境下正常运行 | ⬜ | 待开始 |
| **1.9** | **初步打包验证** | 使用 `electron-builder` 打包第一个 `.exe` 版本，验证安装和运行 | ⬜ | 待开始 |

### Phase 2: 供应商档案与预警 (Supplier Profile & Alerts)
| ID | 任务名称 | 详细描述 | 状态 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **2.1** | **供应商模块开发** | 创建 `public/js/modules/supplier.js`，实现供应商档案管理逻辑 | ⬜ | 基于Phase 1.0的模块化架构 |
| **2.2** | **后端 CRUD 接口** | 开发 `GET/POST/PUT/DELETE /api/suppliers` 接口，实现供应商增删改查 | ⬜ | 待开始 |
| **2.3** | **供应商列表页** | 开发前端表格页面，支持分页、搜索、按等级筛选供应商 | ⬜ | 使用共享组件，遵循BEM规范 |
| **2.4** | **供应商详情页** | 开发详情模态框，展示基本信息、证书列表、历史绩效概览 | ⬜ | 使用共享模态框组件 |
| **2.5** | **证书管理功能** | 实现证书文件上传、有效期录入、状态显示（正常/临期/过期） | ⬜ | 待开始 |
| **2.6** | **邮件服务集成** | 配置 `nodemailer`，封装通用的邮件发送函数 `sendEmail(to, subject, content)` | ⬜ | 待开始 |
| **2.7** | **自动预警逻辑** | 编写定时任务脚本，每日扫描过期证书并触发邮件发送 | ⬜ | 待开始 |

### Phase 3: 绩效评价与高级功能 (Performance & Advanced)
| ID | 任务名称 | 详细描述 | 状态 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **3.1** | **绩效模块开发** | 创建 `public/js/modules/performance.js`，实现绩效评价逻辑 | ⬜ | 基于Phase 1.0的模块化架构 |
| **3.2** | **绩效模型配置** | 建立绩效评分规则表，定义各维度（质量、交付、服务）的权重和计算公式 | ⬜ | 待开始 |
| **3.3** | **自动评分引擎** | 开发后端逻辑，每月自动从 IQC 数据中提取合格率并计算质量得分 | ⬜ | 待开始 |
| **3.4** | **绩效报表前端** | 开发绩效仪表盘，展示雷达图、趋势图和月度评分卡 | ⬜ | 使用共享图表组件，遵循BEM规范 |

---

## 7. 桌面端迁移策略 (Desktop Application Strategy)

您提到的"后续想做成桌面端"，这是一个非常棒的想法！
**好消息是：现有的技术栈 (Node.js + HTML/CSS/JS) 转换成桌面端非常方便，几乎是无缝衔接。**

我们将使用 **Electron** 框架来实现这一目标。

### 为什么选择 Electron？
1.  **代码复用率 99%**：Electron 的核心就是 Chromium 浏览器 + Node.js。我们现在写的 HTML/CSS/JS 前端代码可以直接在 Electron 中运行，无需重写。
2.  **原生能力**：Electron 可以让网页调用 Windows 系统底层能力，比如：
    *   **文件系统**：直接读取本地 Excel，不再需要"上传"这个动作，体验更像原生软件。
    *   **系统通知**：直接弹出 Windows 右下角通知，而不仅仅是网页弹窗。
    *   **开机自启**：可以设置为开机自动后台运行，默默监控证书过期情况。
3.  **离线运行**：数据库 (SQLite) 本地化后，软件可以在无网络环境下（内网）完美运行。

### 迁移步骤预览
1.  **安装 Electron**：`npm install electron --save-dev`
2.  **配置入口**：创建一个 `main.js` (Electron 主进程)，负责创建窗口并加载我们的 `index.html`。
3.  **调整 API 调用**：
    *   目前的 API 是通过 HTTP 请求 (`fetch('/api/...')`) 调用后端。
    *   在 Electron 中，我们可以保留 HTTP 模式（在本地启动一个微型服务器），也可以使用 **IPC (进程间通信)** 直接调用控制器函数，后者性能更好且无需占用端口。
4.  **打包发布**：使用 `electron-builder` 将项目打包成 `.exe` 安装包，支持自定义图标、安装向导等。

**结论**：我们现在所做的每一步 Web 开发工作，都是在为未来的桌面端打基础。**现在的代码完全不会浪费**，未来只需加一层"壳"即可华丽转身为桌面软件。

---

## 8. 架构改进：模块化隔离 (Architectural Improvement: Modular Isolation)

为了避免系统复杂度增加导致"牵一发而动全身"的问题，后续开发将严格遵循以下模块化隔离原则：

### 8.1 核心原则
*   **独立性 (Independence)**：每个业务模块（IQC、供应商档案、绩效、审核）应视为独立的子系统，拥有独立的代码空间。
*   **解耦 (Decoupling)**：修改一个模块的 UI 或逻辑，绝不应影响其他模块的运行。

### 8.2 实施规范
1.  **独立 JS 文件**：
    *   严禁将所有逻辑堆砌在 `main.js` 或 `ui.js` 中。
    *   每个模块必须有独立的控制器文件，例如：
        *   `public/js/modules/iqc.js` (负责 IQC 分析逻辑)
        *   `public/js/modules/supplier.js` (负责供应商档案逻辑)
        *   `public/js/modules/performance.js` (负责绩效评价逻辑)
2.  **独立 CSS 或命名空间**：
    *   每个模块的样式应独立文件（如 `public/css/modules/iqc.css`）。
    *   或者在 `style.css` 中使用严格的 BEM 命名空间（如 `.iqc-container__chart`, `.supplier-card__title`）。
3.  **共享组件提取**：
    *   通用功能（API 请求封装、Loading 动画、模态框基类、工具函数）提取到 `public/js/utils.js` 或 `public/js/common.js`。
4.  **重构阈值**：
    *   当单文件超过 500 行，或包含 >2 个业务模块逻辑时，强制触发拆分重构。